Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id F2A951B31E
	for <lists+alsa-devel@lfdr.de>; Mon, 13 May 2019 11:44:23 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 6DC1616C7;
	Mon, 13 May 2019 11:43:33 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 6DC1616C7
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1557740663;
	bh=kFTLw3ICMWeOjM36wmDe3XcXq1AXVrcuoShfL8VkAqE=;
	h=Date:From:To:In-Reply-To:References:Cc:Subject:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=ChzR8qtvilue03J+aSpZN1KeNheTxKEcTfx2ZhIEPvmHkwExRsr+DDzbo74Q8ceD0
	 r7DexjyMJKSbcI1H/iUfgy7SDmPYmuKFwe06jvoW+avoxGz277CzamUPt7ybxXJitP
	 aQS8MwvEn/gvnZX0U0YJPCZdmW6ntr0OFfJzBK4Q=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id E5358F8968A;
	Mon, 13 May 2019 11:42:38 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 3AE88F89684; Mon, 13 May 2019 11:42:36 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_PASS,URIBL_BLOCKED
 autolearn=disabled version=3.4.0
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 51E5FF8961A
 for <alsa-devel@alsa-project.org>; Mon, 13 May 2019 11:42:32 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 51E5FF8961A
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 6084AACD8;
 Mon, 13 May 2019 09:42:32 +0000 (UTC)
Date: Mon, 13 May 2019 11:42:32 +0200
Message-ID: <s5hftpilmgn.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Kailang <kailang@realtek.com>
In-Reply-To: <6FAB7C47BCF00940BB0999A99BE3547A1D766284@RTITMBSVM07.realtek.com.tw>
References: <6FAB7C47BCF00940BB0999A99BE3547A1D766254@RTITMBSVM07.realtek.com.tw>
 <s5hlfzalnxl.wl-tiwai@suse.de>
 <6FAB7C47BCF00940BB0999A99BE3547A1D766284@RTITMBSVM07.realtek.com.tw>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Cc: " \(alsa-devel@alsa-project.org\)" <alsa-devel@alsa-project.org>
Subject: Re: [alsa-devel] Boot procudure on HDA driver
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Mon, 13 May 2019 11:30:56 +0200,
Kailang wrote:
> 
> 
> 
> > -----Original Message-----
> > From: Takashi Iwai <tiwai@suse.de>
> > Sent: Monday, May 13, 2019 5:11 PM
> > To: Kailang <kailang@realtek.com>
> > Cc: (alsa-devel@alsa-project.org) <alsa-devel@alsa-project.org>
> > Subject: Re: Boot procudure on HDA driver
> > 
> > On Mon, 13 May 2019 11:00:18 +0200,
> > Kailang wrote:
> > >
> > > Hi Takashi,
> > >
> > > When System Boot up.
> > > The Hda Driver running step was as below.
> > >
> > > alc_init();
> > > alc_shutup();
> > > alc_init();
> > >
> > > The depop procedure was put in spec->init_hook and spec->shutup.
> > >
> > > But I find more codec which run spec->shutup at boot up. It will occur pop
> > noise.
> > > If it doesn't run spec->shutup, it will not occur pop noise or reduce pop noise.
> > >
> > > How could the spec->shutup not run at boot up?
> > >
> > > I ever test to put the check in spec->shutup() for PM_EVENT_SUSPEND and
> > PM_EVENT_HIBERNATE and shutdown.
> > > But if power_save=1, it was have issue for this.
> > > Codec was idle already in power_save=1 state. If system go suspend, it will
> > not run spec->shutup() again.
> > 
> > I guess it's a runtime PM, hence it's neither PM_EVENT_SUSPEND nor
> > PM_EVENT_HIBERNATE.
> > 
> runtime PM and suspend and hibernate and shutdown need to run
> spec->shutup().

Is the call really mandatory?

> It's no problem.
> But spec->shutup() doesn't need to run in boot up.

The call of spec->shutup() at boot up *is* the runtime PM.
Or any other call path I overlooked?

> And it will set power_save=1 on all dell machine.
> 
> If (codec->auto_runtime_pm || codec->bus->shutdown ||
>       codec->core.dev.power.power_state.event == PM_EVENT_SUSPEND ||
>       codec->core.dev.power.power_state.event == PM_EVENT_HIBERNATE)
> 
> So, I need to put upper check code in spec->shutup(). Right?
> Thanks.

No, the auto_runtime_pm is for a completely different purpose.

At the boot up, the runtime PM can be kicked in at any time.  So if
you disable the shutup during the runtime PM, it means you'd need to
call the shutup at runtime PM completely.


Takashi

> 
> > Actually, if the shutup procedure makes the problem on a certain platform, just
> > skip it.  It's an optional behavior and would be fine without it (of course only if
> > it's confirmed to work :)
> > 
> > 
> > Takashi
> > 
> > ------Please consider the environment before printing this e-mail.
> 
_______________________________________________
Alsa-devel mailing list
Alsa-devel@alsa-project.org
https://mailman.alsa-project.org/mailman/listinfo/alsa-devel
