Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id E2FF1328026
	for <lists+alsa-devel@lfdr.de>; Mon,  1 Mar 2021 14:59:55 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 78EFC168C;
	Mon,  1 Mar 2021 14:59:05 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 78EFC168C
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1614607195;
	bh=tGNgJDxqspvsr0dQh5pybJhOA/yg7K6NS7bEd73wpdY=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=QXG7ibBgDV44PvEppSAD4YGlUEVhCmYnlsRkYiFr23pR6e7S8P4Os9jDhrTCtGnsx
	 s5PjbPGN5iOVD7zrIMZ6gorLdZxHHJmwoixtb6l6xgJKia/iAzJy0LcWPgWsh43oiR
	 a+urh3lwOtemFr7Hu8MNxQZsUXJ3tcqJQY9WYsv0=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id C25D5F804D1;
	Mon,  1 Mar 2021 14:58:24 +0100 (CET)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 67665F80475; Mon,  1 Mar 2021 14:58:23 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_NONE,
 URIBL_BLOCKED autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 4EBAEF80475
 for <alsa-devel@alsa-project.org>; Mon,  1 Mar 2021 14:58:15 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 4EBAEF80475
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id 8A9FDAC24;
 Mon,  1 Mar 2021 13:58:15 +0000 (UTC)
Date: Mon, 01 Mar 2021 14:58:15 +0100
Message-ID: <s5hv9abht6w.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Nicolas MURE <nicolas.mure2019@gmail.com>
Subject: Re: [PATCH 3/4] ALSA: usb-audio: Configure Pioneer DJM-850 samplerate
In-Reply-To: <20210226133429.20081-4-nicolas.mure2019@gmail.com>
References: <20210226133429.20081-1-nicolas.mure2019@gmail.com>
 <20210226133429.20081-4-nicolas.mure2019@gmail.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: alsa-devel@alsa-project.org, livvy@base.nu
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Fri, 26 Feb 2021 14:34:28 +0100,
Nicolas MURE wrote:
> 
> Send an `URB_CONTROL out` USB frame to the device to configure its
> samplerate. This should be done before using the device for audio
> streaming (capture or playback).
> 
> About the change of `usb_rcvctrlpipe` to `usb_sndctrlpipe`, I reached
> the author of this line and she agrees about this change. Control frames
> to set device options should have the `out` direction instead of the `in`
> direction.

This specific fix should be applied separately for 5.12.
Could you split this one and submit as an individual fix?

I'm currently thinking of merging the rest for 5.13, as 5.12 merge
window was already closed.


thanks,

Takashi

> 
> See https://github.com/nm2107/Pioneer-DJM-850-driver-reverse-engineering
>     /blob/172fb9a61055960c88c67b7c416fe5bf3609807b
>     /doc/windows-dvs/framerate-setting/README.md
> 
> Signed-off-by: Nicolas MURE <nicolas.mure2019@gmail.com>
> ---
>  sound/usb/quirks.c | 5 ++++-
>  1 file changed, 4 insertions(+), 1 deletion(-)
> 
> diff --git a/sound/usb/quirks.c b/sound/usb/quirks.c
> index 9ba4682ebc48..d02dac5fcd40 100644
> --- a/sound/usb/quirks.c
> +++ b/sound/usb/quirks.c
> @@ -1482,7 +1482,7 @@ static int pioneer_djm_set_format_quirk(struct snd_usb_substream *subs,
>  	usb_set_interface(subs->dev, 0, 1);
>  	// we should derive windex from fmt-sync_ep but it's not set
>  	snd_usb_ctl_msg(subs->stream->chip->dev,
> -		usb_rcvctrlpipe(subs->stream->chip->dev, 0),
> +		usb_sndctrlpipe(subs->stream->chip->dev, 0),
>  		0x01, 0x22, 0x0100, windex, &sr, 0x0003);
>  	return 0;
>  }
> @@ -1503,6 +1503,9 @@ void snd_usb_set_format_quirk(struct snd_usb_substream *subs,
>  	case USB_ID(0x2b73, 0x0013): /* Pioneer DJM-450 */
>  		pioneer_djm_set_format_quirk(subs, 0x0082);
>  		break;
> +	case USB_ID(0x08e4, 0x0163): /* Pioneer DJM-850 */
> +		pioneer_djm_set_format_quirk(subs, 0x0086);
> +		break;
>  	}
>  }
>  
> -- 
> 2.29.2
> 
