Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id A07FD36AC0E
	for <lists+alsa-devel@lfdr.de>; Mon, 26 Apr 2021 08:15:37 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 1DD891687;
	Mon, 26 Apr 2021 08:14:47 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 1DD891687
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1619417737;
	bh=b5Bi271bmhAKuW8J6C6NzNhVZN397xkhRtFMQfmqugM=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=ZkhXSz3N6/JptQhUT8pTP2ifSBGFLIKp5k9VsXpeDVMUb+bxgyPsBJ1eKrZfFpKC8
	 qOrLTGhzaxyrPRTPI/V7qIFl328iaBy95egNa+uK3CwDP4oaPFFZS6wbdI3k9296+q
	 Js081ajqT7zMxVHyIbk83YxEgOOX0aV314MqJx54=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id DAB8EF80171;
	Mon, 26 Apr 2021 08:14:08 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 4B83EF8016C; Mon, 26 Apr 2021 08:14:06 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.1 required=5.0 tests=KHOP_HELO_FCRDNS, SPF_HELO_NONE,
 SPF_NONE autolearn=disabled version=3.4.0
Received: from relmlie5.idc.renesas.com (relmlor1.renesas.com
 [210.160.252.171])
 by alsa1.perex.cz (Postfix) with ESMTP id ECEA0F800E3
 for <alsa-devel@alsa-project.org>; Mon, 26 Apr 2021 08:13:59 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz ECEA0F800E3
Date: 26 Apr 2021 15:13:55 +0900
X-IronPort-AV: E=Sophos;i="5.82,251,1613401200"; d="scan'208";a="79475179"
Received: from unknown (HELO relmlir5.idc.renesas.com) ([10.200.68.151])
 by relmlie5.idc.renesas.com with ESMTP; 26 Apr 2021 15:13:55 +0900
Received: from mercury.renesas.com (unknown [10.166.252.133])
 by relmlir5.idc.renesas.com (Postfix) with ESMTP id 59BB7400CA0E;
 Mon, 26 Apr 2021 15:13:55 +0900 (JST)
Message-ID: <874kft4lp8.wl-kuninori.morimoto.gx@renesas.com>
From: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
To: Mark Brown <broonie@kernel.org>
Subject: Re: [PATCH 2/7] ASoC: soc-core: add snd_soc_runtime_get_dai_fmt()
In-Reply-To: <20210423183503.GK5507@sirena.org.uk>
References: <871rb3hypy.wl-kuninori.morimoto.gx@renesas.com>
 <87y2dbgk47.wl-kuninori.morimoto.gx@renesas.com>
 <20210423183503.GK5507@sirena.org.uk>
User-Agent: Wanderlust/2.15.9 Emacs/26.3 Mule/6.0
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Cc: Linux-ALSA <alsa-devel@alsa-project.org>
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>


Hi Mark

Thank you for your feedback

> the other edge) but there are other examples.  This means we probably
> want drivers to be able to list at least two levels of preferences for
> formats separately then try to ideally use one they both like, but it
> gets a little tricky.  We probably also want to have some priority list
> in the kernel where we try to rank how likely formats are to have bugs
> in the hardware to maximise the chances that things will work.
(snip)
> I'm not 100% sure I get why we have the separate _POSSIBLE_ macros here?
> One thing we'll have to take account of is that there's some DAIs that
> have some restrictions on what options they can combine - for example
> only doing I2S with one format of clock but allowing clock inversion in
> DSP mode.  It might be safer (if tedious for driver authors without some
> help...) to just have arrays of fully specified daifmt values.
(snip)
> > +	/* use original dai_fmt if sound card specify */
> > +	if (!(dai_link->dai_fmt & SND_SOC_DAIFMT_FORMAT_MASK))
> > +		mask |= SND_SOC_DAIFMT_FORMAT_MASK;
> > +	if (!(dai_link->dai_fmt & SND_SOC_DAIFMT_CLOCK_MASK))
> > +		mask |= SND_SOC_DAIFMT_CLOCK_MASK;
> > +	if (!(dai_link->dai_fmt & SND_SOC_DAIFMT_INV_MASK))
> > +		mask |= SND_SOC_DAIFMT_INV_MASK;
> > +	if (!(dai_link->dai_fmt & SND_SOC_DAIFMT_MASTER_MASK))
> > +		mask |= SND_SOC_DAIFMT_MASTER_MASK;
> > +
> > +	dai_link->dai_fmt =	dai_link->dai_fmt | (dai_fmt & mask);
> 
> If the sound card specifies something why not just use it verbatim
> instead of trying to merge?

I'm thinking the way that for example select "format" automatically,
but specify others from Card, etc (= not all settings).
Because as you are concerning, some driver might has complex limitations for some parts.
We want to manually and directly select it from Card in such case.

My idea was very simple, but indeed I could understand your concern.
I have no good idea so far, but want to consider about it more.

Thank you for your help !!

Best regards
---
Kuninori Morimoto
