Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 5BA022FCD70
	for <lists+alsa-devel@lfdr.de>; Wed, 20 Jan 2021 10:29:28 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id D56641852;
	Wed, 20 Jan 2021 10:28:37 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz D56641852
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1611134968;
	bh=YUDdni26u1FiQjAobfnygX84sdXc6dRWfaE8N0rmPO8=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=dGKmFbhhf8OYF4kvITuSkT6ndO08QozLUR42TrGGAU7QpoWaCP4RTUS56GqcwWJxg
	 p5HQXfa0rNEv+XYDAnSj1LX6YM5lAfYbSqXkquofk9AeM7p5/zKCsJ9D5+mlPVslW4
	 ZTNzq3KCkRiySsIwYB4x7bXknv59HvcnVukzUQcw=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 2F333F8019B;
	Wed, 20 Jan 2021 10:27:54 +0100 (CET)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 729C5F8016E; Wed, 20 Jan 2021 10:27:52 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_NONE,
 URIBL_BLOCKED autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 77DACF8012C
 for <alsa-devel@alsa-project.org>; Wed, 20 Jan 2021 10:27:44 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 77DACF8012C
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id E6DE1AAAE;
 Wed, 20 Jan 2021 09:27:43 +0000 (UTC)
Date: Wed, 20 Jan 2021 10:27:43 +0100
Message-ID: <s5hwnw8dkkw.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Takashi Sakamoto <o-takashi@sakamocchi.jp>
Subject: Re: [PATCH] ALSA: control: remove limitation on the number of
 user-defined control element set per card
In-Reply-To: <20210120085541.28607-1-o-takashi@sakamocchi.jp>
References: <20210120085541.28607-1-o-takashi@sakamocchi.jp>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: alsa-devel@alsa-project.org
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Wed, 20 Jan 2021 09:55:41 +0100,
Takashi Sakamoto wrote:
> 
> ALSA control core allows usespace application to register control element
> set by call of ioctl(2) with SNDRV_CTL_IOCTL_ELEM_ADD request. The added
> control element set is called as 'user-defined'. Currently sound card has
> limitation on the number of the user-defined control element set up
> to 32.
> 
> The limitation is inconvenient to drivers in ALSA firewire stack since
> the drivers expect userspace applications to implement function to
> control device functionalities such as mixing and routing. As the
> userspace application, snd-firewire-ctl-services project starts:
> https://github.com/alsa-project/snd-firewire-ctl-services/
> 
> The project supports many devices supported by ALSA firewire stack. The
> limitation is mostly good since routing and mixing controls can be
> represented by control element set, which includes control element with
> the same parameters. Nevertheless, it's actually inconvenient to device
> which has many varied functionalities. For example, plugin effect such as
> channel strip and reverb has many parameters. For the case, many control
> elements are required to configure the parameters and control element set
> cannot aggregates controls for the parameters. At present, below models
> are implemented with the control elements and actually add control element
> sets over 32:
> 
>  * Apogee Emsemble (snd-bebob-ctl-service)
>  * TC Electronic Konnekt 24d (snd-dice-ctl-service)
>  * TC Electronic Studio Konnekt 48 (snd-dice-ctl-service)
>  * TC Electronic Konnekt Live (snd-dice-ctl-service)
>  * TC Electronic Impact Twin (snd-dice-ctl-service)
> 
> It could be investigated to increase the number; e.g. quadruple to the
> current (=128), however it's hard to find criteria about the number for
> existent sound card. This commit just removes the limitation for the
> reason. ALSA control core uses UINT_MAX as the maximum number of control
> elements added to a sound card. It's limitation for both in-kernel driver
> and userspace application.
> 
> Signed-off-by: Takashi Sakamoto <o-takashi@sakamocchi.jp>

I'm still worried by the unlimited number of possible additions.
Did you check what would happen if you run a test program to add
user-space ctls (with the max count) in a loop repeatedly?  If that
doesn't blow up too much, it might be OK.  Otherwise we have to add
some practical limits.

So, let's prove that it's absolutely safe to release the limit at
first.


thanks,

Takashi
