Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 98E9735E2D6
	for <lists+alsa-devel@lfdr.de>; Tue, 13 Apr 2021 17:28:58 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 330F81670;
	Tue, 13 Apr 2021 17:28:08 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 330F81670
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1618327738;
	bh=KvTpyfzQYTfEhFIpQ+NItDIOPsDD6KWwl0bA7wEUNjA=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=Z5hYKsQvC4EfsEas6Z9P2wjwIcTuS/OC/dGvXIiKcHNbTvXhUj+5l+0kmuvzwfwT9
	 3sXq7aEBd8kWMmlR1dgiXZ+4dnnpWH0A5b5WdzssQv5wwb48MLRUoEU4k8DUlpa/2Z
	 IGPDDO5BjdX9zTQLdRgy9Lp0KYFFdK9njg6HrZVw=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 88621F8022D;
	Tue, 13 Apr 2021 17:27:24 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 88036F8022B; Tue, 13 Apr 2021 17:27:21 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_NONE
 autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 262E2F800EB
 for <alsa-devel@alsa-project.org>; Tue, 13 Apr 2021 17:27:17 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 262E2F800EB
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id 5AFD2B250;
 Tue, 13 Apr 2021 15:27:17 +0000 (UTC)
Date: Tue, 13 Apr 2021 17:27:17 +0200
Message-ID: <s5hy2dmw6ga.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: David Henningsson <coding@diwic.se>
Subject: Re: [PATCH v4] sound: rawmidi: Add framing mode
In-Reply-To: <e912ae71-5b52-8b1f-b3fa-b9bb6420be29@diwic.se>
References: <20210410120229.1172054-1-coding@diwic.se>
 <s5him4r3k1d.wl-tiwai@suse.de>
 <e912ae71-5b52-8b1f-b3fa-b9bb6420be29@diwic.se>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: alsa-devel@alsa-project.org
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Mon, 12 Apr 2021 21:32:37 +0200,
David Henningsson wrote:
> 
> > One thing I'm considering is how to inform the current framing and the
> > timestamp mode to user-space.  Currently we have only the ioctl to set
> > the values but not to inquiry.
> 
> Yes, this is the same as we do with PCM. There is no ioctl to get
> current hw/sw params either.
> 
> > Should we put those new information into the info or the status ioctl?
> 
> I would prefer neither, because it is not necessary and creates an
> inconsistency with PCM.

Well, honestly speaking, ALSA PCM API design is no best one you should
refer to...  IMO, it should have had the symmetric get function, too.
I guess it worked without such ioctl because the current PCM status is
exposed via proc file.  Without a way for inquiry of the current
status, we may have had trouble for debugging.

In that sense, it might make sense to extend the proc entry of the
rawmidi status output, too.

> > If so, it might be also helpful to inform the frame byte size
> > explicitly there, instead of assuming only a constant.
> 
> If userspace has verified the kernel protocol version and successfully
> calledSNDRV_RAWMIDI_IOCTL_PARAMS with the framing
> byte/bitfield/whatever set, then userspace can be sure that the frames
> are according to the snd_rawmidi_framing_tstamp struct. Knowing the
> frame byte size but not knowing the exact format is of no use to
> userspace anyway, right?

Sure, if any, the kernel should inform all stuff, the frame type, the
clock type, and the frame size.  But practically seen, this might be
not often inquired, if we define the frame struct explicitly as a part
of user-space API, too.  Then sizeof() already gives the proper size.
Of course, that depends on how to provide the user-space API.  We may
provide again an opaque API, too.


Takashi
