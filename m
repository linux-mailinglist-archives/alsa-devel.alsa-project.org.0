Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 4205D6D16C
	for <lists+alsa-devel@lfdr.de>; Thu, 18 Jul 2019 17:55:07 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 93B6A1683;
	Thu, 18 Jul 2019 17:54:16 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 93B6A1683
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1563465306;
	bh=OvCZO+t2ivAKnxBkBjyCF+lix+eP7jRzlbE/wckMCwY=;
	h=Date:From:To:In-Reply-To:References:Cc:Subject:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=E27WgMqQ8Ccy4VmIS1FDjUHIZh0K4JVAyz2l1tMUWM4tCWpA2s1iSKoWsAg1Fxm2P
	 nm33epD0grtXBPUh6I0DPdMGWLk/8JtjCu2NCYsDWP+bJEXOzpaf/Fd4du7WNJJYoD
	 InxBkkH0Ro6aDrZXKSERhCBtVZJGQx748mTxqmL8=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id B5A2BF80376;
	Thu, 18 Jul 2019 17:53:22 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 5EAEBF80376; Thu, 18 Jul 2019 17:53:19 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_PASS,
 URIBL_BLOCKED autolearn=disabled version=3.4.0
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 14F06F800D2
 for <alsa-devel@alsa-project.org>; Thu, 18 Jul 2019 17:53:15 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 14F06F800D2
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id D5F13AF30;
 Thu, 18 Jul 2019 15:53:14 +0000 (UTC)
Date: Thu, 18 Jul 2019 17:53:13 +0200
Message-ID: <s5hd0i7nxue.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: "Geoffrey D. Bennett" <g@b4.vu>
In-Reply-To: <20190717155105.GA4198@b4.vu>
References: <20190717155105.GA4198@b4.vu>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Cc: alsa-devel@alsa-project.org
Subject: Re: [alsa-devel] [PATCH V6 RESEND] ALSA: usb-audio: Scarlett Gen 2
	mixer interface
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Wed, 17 Jul 2019 17:51:05 +0200,
Geoffrey D. Bennett wrote:
> 
> Add mixer quirk for the Focusrite Scarlett 6i6, 18i8, and 18i20 Gen 2
> audio interfaces. Although the interfaces are USB compliant,
> additional input/output level controls and hardware routing/mixing
> functionality are available using proprietary USB requests.
> 
> Signed-off-by: Geoffrey D. Bennett <g@b4.vu>
> ---
> Hi all,
> 
> This patch adds the following controls for the Scarlett 6i6, 18i8, and
> 18i20 Gen 2:
> - Master volume knob indicator (18i20 only)
> - Mute and dim switches (18i20 only)
> - Volume controls for the analogue HW outputs
> - HW/SW volume switches for the 10 analogue HW outputs (18i20 only)
> - Line Level/Instrument Level and Pad controls (6i6 and 18i8 only)
> - Output mux (where the sound for the HW outputs comes from; defaults
>   to PCM outputs)
> - Capture mux (where the sound for PCM recording comes from; defaults
>   to HW inputs)
> - Matrix mux (where the sound going into the mixer comes from; 18
>   inputs default off)
> - Mixer matrix (18 inputs * 10 outputs = 180 controls)
> - Level meters
> 
> Changes since v1:
> - Add support for the Scarlett 18i8 Gen 2
> - Save configuration parameters to NVRAM
> - Implemented feedback from Takashi's email 24/Apr/2019
> - Moved private field from struct snd_usb_audio to struct
>   usb_mixer_interface
> - Added timer and buffer fields to struct usb_mixer_interface
> - Other small code fixes/cleanups/improvements
> 
> Changes since v2:
> - Add support for the Scarlett 6i6 Gen 2
> - Add support for controlling the mute/dim switches (18i20 only)
> - Implemented feedback from Takashi's email 29/Apr/2019: One pointer
>   field private_data and one function pointer private_free. Replaced
>   timer with delayed work (thanks for that suggestion; it makes the
>   code a *lot* simpler!).
> - The new functionality is disabled by default as there were reports
>   of some Gen 2 devices not responding to the initialisation sequence
>   and hanging. Added module parameter "scarlett_gen2_mixer_enable".
>   If this parameter is not set, logs a message "Focusrite Scarlett Gen
>   2 Mixer Driver disabled; use options snd_usb_audio
>   scarlett_gen2_mixer_enable=1 to enable and report any issues to
>   g@b4.vu".
> 
> Changes since v3:
> - No functional changes; fix checkpatch.pl error and typo in
>   declaration.
> 
> Changes since v4:
> - Implemented feedback from Takashi's email 9/Jul/2019: cancel
>   delayed work on suspend, drop copyright texts, remove unnecessary
>   blank lines, and run kmalloc outside the mutex.
> 
> Changes since v5:
> - Implemented feedback from Takashi's emails 9-10/Jul/2019: use
>   chip->setup value (device_setup option) instead of the
>   scarlett_gen2_mixer_enable option and sync config to NVRAM
>   immediately on suspend.
> - Fixed issue where the config save delayed work would be cancelled
>   and not restarted if a scarlett2_*_ctl_put() function was called and
>   the parameter value was not changed.
> - Renaming definitions and functions for consistency and move private
>   free/suspend functions above their use so pre-declaration isn't
>   necessary.

Thanks, the patch looks almost good, but it's already too late for
5.3, so I'm going to queue this for 5.4 after 5.3 merge window is
closed in this week.

But, before that, maybe one more refresh would be appreciated.
Namely,

- We need a verification of the fixed pipe before actually submitting
  urb.  scarlett2_usb() calls with usb_sndctrlpipe(), and this pipe
  has to be verified beforehand.  See the commit 801ebf1043ae for
  details.

- Some pointers seem to be initialized as "0".  Use NULL instead.


Takashi
_______________________________________________
Alsa-devel mailing list
Alsa-devel@alsa-project.org
https://mailman.alsa-project.org/mailman/listinfo/alsa-devel
