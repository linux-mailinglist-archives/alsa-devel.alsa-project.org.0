Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 636231F1A34
	for <lists+alsa-devel@lfdr.de>; Mon,  8 Jun 2020 15:37:35 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 033091663;
	Mon,  8 Jun 2020 15:36:45 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 033091663
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1591623455;
	bh=5LS40918utfv2r+WYIYWKVpQHjWnzmhgEZ+P6FC0RIc=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=MhCC4UWAFBaZK4CcVztypdPP3ncAQ8VqNAstg42i+GCjopVqw0sAu41Yy4WQrGoww
	 Kpt1TP/pgwncW4Nqh+VcA53JdmHmXgqKnbWl4EMjgn1izuJi2y9jkO3S5BWWKpQRtb
	 46SyjMJLFvDmQwiQfJZgiLRjTj3hheVOoEa/mMKY=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 22BBCF8021E;
	Mon,  8 Jun 2020 15:35:54 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 29308F8021C; Mon,  8 Jun 2020 15:35:50 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.3 required=5.0 tests=PRX_BODYSUB_17,
 RCVD_IN_MSPIKE_H3, RCVD_IN_MSPIKE_WL, SPF_HELO_NONE,
 SPF_PASS autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id BBB44F80125
 for <alsa-devel@alsa-project.org>; Mon,  8 Jun 2020 15:35:45 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz BBB44F80125
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id 36F9CAC2D;
 Mon,  8 Jun 2020 13:35:48 +0000 (UTC)
Date: Mon, 08 Jun 2020 15:35:44 +0200
Message-ID: <s5htuzl4r4f.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Thomas Ebeling <penguins@bollie.de>
Subject: Re: Clock sync problem?
In-Reply-To: <14f91307-c121-a9f8-4045-1319ee0ca49e@bollie.de>
References: <20200607133959.kmljpqdwefuio3mk@overdrive.tratt.net>
 <s5hk10i58io.wl-tiwai@suse.de>
 <14f91307-c121-a9f8-4045-1319ee0ca49e@bollie.de>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: alsa-devel@alsa-project.org
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Mon, 08 Jun 2020 10:32:24 +0200,
Thomas Ebeling wrote:
> 
> 
> On 08.06.20 09:19, Takashi Iwai wrote:
> > On Sun, 07 Jun 2020 15:39:59 +0200,
> > Laurence Tratt wrote:
> >> Hello,
> >>
> >> I've found an interesting issue with an SSL2+ audio interface -- it plays and
> >> records fine (and, for the money, the sound quality is excellent!), but
> >> recording slowly but surely drifts over time. For example, if I record a
> >> click track in Audacity (or Ardour), play it through the interface and record
> >> it, and then line up the start of the recorded click track with the original,
> >> the two tracks will be around 5ms out of alignment after 30s. Interestingly,
> >> this problem does not happen with OpenBSD, where the two tracks line up
> >> precisely.
> >>
> > The recent change in USB-audio might help for a case like yours.
> > Try my sound git tree (for-linus branch) or Linus' tree.  The former
> > should be pullable onto 5.7 kernel cleanly.
> 
> Since I recently had clock drift issues with Audient devices, I'm
> intrigued by this. @Takashi Can you quickly elaborate, what you think,
> Laurance's issue might be and what has changed in that tree that might
> help him fix it? Is there some general issue with the current (stable)
> sound/usb implementation?

The frame size calculation in USB-audio driver wasn't accurate enough
because of the computation in Q16.16 format.  It works OK for async
mode, but for others, it can accumulate rounding errors.  The recent
change corrected it for a more precise way.


Takashi
