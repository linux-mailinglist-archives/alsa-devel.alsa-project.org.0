Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 71F2231B5BF
	for <lists+alsa-devel@lfdr.de>; Mon, 15 Feb 2021 08:52:20 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id ECB2015E0;
	Mon, 15 Feb 2021 08:51:29 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz ECB2015E0
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1613375540;
	bh=i05zNNxypP9gnRDqaYwF25tiMAbgdB926GKmH2e4HDw=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=lmCi6eS34nQkG72E834r/LcP49jR4ztCLuxC9vg1VfysSdZZH85BB/9W5X4gTp/yh
	 BQ7sfN1mwQNvIyJOaEoA5lCui2O20l4T+LBrxz7nwwKS7dWtmh2pdiotvEb7SVkKri
	 6G8j6xxld5ArsWRCUKCkqB7dkJbpMqyZEQJn+p3k=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 33B3CF8025B;
	Mon, 15 Feb 2021 08:50:49 +0100 (CET)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id E0300F80258; Mon, 15 Feb 2021 08:50:47 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_NONE,
 URIBL_BLOCKED autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 8E6DCF80089
 for <alsa-devel@alsa-project.org>; Mon, 15 Feb 2021 08:50:37 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 8E6DCF80089
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id 18999AE03;
 Mon, 15 Feb 2021 07:50:37 +0000 (UTC)
Date: Mon, 15 Feb 2021 08:50:36 +0100
Message-ID: <s5him6tbwhf.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Jaroslav Kysela <perex@perex.cz>
Subject: Re: [PATCH 0/5] ALSA: control - add generic LED trigger code
In-Reply-To: <15cd340d-6359-b0fd-d4b1-8aa8c3563bf8@perex.cz>
References: <20210211111400.1131020-1-perex@perex.cz>
 <s5h1rdmfrvo.wl-tiwai@suse.de>
 <3c84c275-0c62-d2f4-38ad-be6accb3b159@perex.cz>
 <s5hblcpej13.wl-tiwai@suse.de>
 <b1bc4135-25b9-26aa-323d-23bea15e164c@perex.cz>
 <s5hwnvdcvwf.wl-tiwai@suse.de>
 <15cd340d-6359-b0fd-d4b1-8aa8c3563bf8@perex.cz>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: Hans de Goede <hdegoede@redhat.com>,
 ALSA development <alsa-devel@alsa-project.org>,
 Perry Yuan <Perry.Yuan@dell.com>
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Sun, 14 Feb 2021 19:55:21 +0100,
Jaroslav Kysela wrote:
> 
> Dne 12. 02. 21 v 13:28 Takashi Iwai napsal(a):
> > On Fri, 12 Feb 2021 11:32:38 +0100,
> > Jaroslav Kysela wrote:
> >>
> >> Dne 12. 02. 21 v 10:23 Takashi Iwai napsal(a):
> >>> On Thu, 11 Feb 2021 18:53:20 +0100,
> >>> Jaroslav Kysela wrote:
> >>>>
> >>>> Dne 11. 02. 21 v 18:15 Takashi Iwai napsal(a):
> >>>>
> >>>>>> Jaroslav Kysela (5):
> >>>>>>   ALSA: control - introduce snd_ctl_notify_one() helper
> >>>>>>   ALSA: control - add layer registration routines
> >>>>>>   ALSA: control - add generic LED trigger module as the new control
> >>>>>>     layer
> >>>>>>   ALSA: HDA - remove the custom implementation for the audio LED trigger
> >>>>>>   ALSA: control - add sysfs support to the LED trigger module
> >>>>
> >>>>> One thing I still miss from the picture is how to deal with the case
> >>>>> like AMD ACP.  It has no mixer control to bundle with the LED trigger.
> >>>>> Your idea is to make a (dummy) user element and tie the LED trigger
> >>>>> with it?
> >>>>
> >>>> Yes, the user-space code which guarantee the silence stream should create an
> >>>> user space control with the appropriate LED group access bits. The alsa-lib's
> >>>> softvol PCM plugin can do this silencing for example.
> >>>
> >>> What control would it create?  In the case of softvol, it's a volume
> >>> control that really changes the volume.  For the mute LED, it's a
> >>> control turn on/off the mute?  If so, I wonder what makes better than
> >>> creating it from the kernel driver.  (Of course, we can list up like
> >>> "flexibility", etc, but it has a flip side of "complexity" and
> >>> "fragility"...)
> >>
> >> The current code handles both switch / volume for the marked control (assuming
> >> that the minimal value - usually zero - is full mute). And actually, there are
> >> snd_pcm_areas_silence() calls in the softvol plugin, so we know that the PCM
> >> stream is not passed to the application at this point.
> >>
> >> Condition:
> >>
> >>       if (info.type == SNDRV_CTL_ELEM_TYPE_BOOLEAN ||
> >>           info.type == SNDRV_CTL_ELEM_TYPE_INTEGER)
> >>           ... value.value.integer.value[i] != info.value.integer.min
> >>
> >> The softvol plugin may be extended to add the mute switch control, of course.
> > 
> > Well, my question was what kind of mixer control will be added at all,
> > although the chip does neither volume nor mute function.  Would we add
> > a fake volume/switch like softvol, or would we add rather a control
> > that is directly tied with the LED state?
> 
> I don't understand your question. If the user space marks the own vol/sw
> control with the LED group, then it's tied with the LED state. I believe that
> the control should be created in the code which make sure that the PCM stream
> is silenced (like alsa-lib's softvol plugin).

The softvol (or similar effect) is to be ignored by PA, as it's not
suitable with the timer-scheduled type of PCM streaming.  So the
control shouldn't have any actual effect of PCM stream itself but
merely for controlling the LED state.  If that's the case, it
shouldn't be named like "XXX Switch" or "XXX Volume", but it's a
control like "Mic Mute LED Status" -- and ironically, that's a kind of
thing we didn't want to take in the kernel side implementation...

That said, I see the value of a generic code for the LED control that
is tied with the existing volume/switch; there is already such an
implementation in HD-audio, and applying to the other drivers makes
sense.  OTOH, for the case for AMD ACP, I'm still not sure what's the
best way.


thanks,

Takashi




Takashi

> 
> 						Jaroslav
> 
> -- 
> Jaroslav Kysela <perex@perex.cz>
> Linux Sound Maintainer; ALSA Project; Red Hat, Inc.
> 
