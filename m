Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 3575C3CF16F
	for <lists+alsa-devel@lfdr.de>; Tue, 20 Jul 2021 03:40:18 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id B365E165D;
	Tue, 20 Jul 2021 03:39:27 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz B365E165D
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1626745217;
	bh=tNlLssYGHLUUPvtcdsaaPuxwZ4/QbpVgp78SBQ2akSg=;
	h=Date:From:Subject:To:Cc:List-Id:List-Unsubscribe:List-Archive:
	 List-Post:List-Help:List-Subscribe:From;
	b=OjZZKrRtRU6zwEUw2bEGJ8nsgKNahUzBC38/hjKKMo3mMbRFEzcPXN3DdCnx3RtVt
	 bgF083bJD5Ywzw949bcCWdfVPm7879HdIe7ieuRomibtqyq7b4B4rsOkwVuxzl9KDb
	 ctHbY2wBJZ2Eqckfd2AnHeLHfXPjujt007ky4wkw=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 1465DF800C5;
	Tue, 20 Jul 2021 03:38:51 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id E4062F80227; Tue, 20 Jul 2021 03:38:48 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: ***
X-Spam-Status: No, score=3.4 required=5.0 tests=AC_FROM_MANY_DOTS,
 KHOP_HELO_FCRDNS,SPF_HELO_NONE,SPF_NONE autolearn=disabled version=3.4.0
Received: from relmlie5.idc.renesas.com (relmlor1.renesas.com
 [210.160.252.171])
 by alsa1.perex.cz (Postfix) with ESMTP id 016DAF80169
 for <alsa-devel@alsa-project.org>; Tue, 20 Jul 2021 03:38:43 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 016DAF80169
Date: 20 Jul 2021 10:38:40 +0900
X-IronPort-AV: E=Sophos;i="5.84,253,1620658800"; d="scan'208";a="88181300"
Received: from unknown (HELO relmlir6.idc.renesas.com) ([10.200.68.152])
 by relmlie5.idc.renesas.com with ESMTP; 20 Jul 2021 10:38:40 +0900
Received: from mercury.renesas.com (unknown [10.166.252.133])
 by relmlir6.idc.renesas.com (Postfix) with ESMTP id 804174152EE3;
 Tue, 20 Jul 2021 10:38:40 +0900 (JST)
Message-ID: <87a6mhwyqn.wl-kuninori.morimoto.gx@renesas.com>
From: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
Subject: [PATCH v2 00/14] ASoC: add Audio Graph Card2 driver
User-Agent: Wanderlust/2.15.9 Emacs/26.3 Mule/6.0
To: Mark Brown <broonie@kernel.org>
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Cc: Linux-ALSA <alsa-devel@alsa-project.org>
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>


Hi Mark

We already have Audio-Graph-Card which is Of-Graph base general sound
card driver. Basically it supports basic CPU-Codec connection, and is
also supporting DPCM connection. Because it was forcibly expanded to
DPCM, DT parsing is very limited and very difficult to add new features
on it, for example Multi CPU/Codec support, Codec2Codec support, etc.

And some users want to use Audio-Graph-Card as basic connection and
expand/customize its own settings on it.

This patch adds more flexible new Audio-Graph-Card2 driver for it.
Audio-Graph-Card and Audio-Graph-Card2 are similar, but don't have
full compatibility.
The reason why I need Audio-Graph-Card2 instead of update Audio-Graph-Card
is that it is very difficult to keep compatibilty.

Audio-Graph-Card2 supports Normal Connection, DPCM Connection,
Multi CPU/Codec Connection, Codec2Codec Connection, and possible to
Customizing.

This patch-set adds Audio-Graph-Card2 driver and customized driver
sample, and DT settings sample which can be used for testing.

To enable testing/debuging, this patch-set also adds Test-Component
driver. We already have Dummy Component and/or Dummy DAI on soc-utils,
but 1) we can't use it from DT, 2) it do nothing.
Added new Test-Component can be used from DT, and it can indicate called
function name. We can use it to trace callback order / understanding
ALSA SoC behavior, etc.
Sample DT settings which can be used for testing is using Test-Component.

This patch set includes sample DT for custome driver and/or
audio-graph-card2. You can easily try to use/test it if you added
below line to your DT file. It needs below CONFIGs.
It will probe sample Sound Card which has Normal/DPCM/Multi/Codec2Codec
connections.

	#include "../../../../../sound/soc/generic/audio-graph-card2-sample.dtsi"

	CONFIG_SND_AUDIO_GRAPH_CARD2
	CONFIG_SND_SAMPLE_CUSTOM_CARD
	CONFIG_SND_TEST_COMPONENT

There are some notes.

Because Audio Graph Card2 is still under experimental stage, it will
indicate such warning when probing, and the DT might be updated/exchanged.

It can use Codec2Codec, but it will start automatically when probed,
and can't stop it so far. It should be updated.

 1 -  2 : add Test-Component driver
 3 -  9 : add Audio-Graph-Card2 driver
10      : add Audio-Graph-Card2 base custome driver sample
11 - 14 : Audio-Graph-Card2 driver / custome driver DT sample

Link: https://lore.kernel.org/r/87k0xszlep.wl-kuninori.morimoto.gx@renesas.com
Link: https://lore.kernel.org/r/871r8u4s6q.wl-kuninori.morimoto.gx@renesas.com

v1 -> v2
	- don't use "port" base for_each loop

Kuninori Morimoto (14):
   1 ASoC: test-component: add Test Component YAML bindings
   2 ASoC: test-component: add Test Component for Sound debug/test
   3 ASoC: simple-card-utils: add asoc_graph_is_ports0()
   4 ASoC: simple-card-utils: add codec2codec support
   5 ASoC: audio-graph-card2: add Audio Graph Card2 driver
   6 ASoC: audio-graph-card2: add DPCM support
   7 ASoC: audio-graph-card2: add Multi CPU/Codec support
   8 ASoC: audio-graph-card2: add Codec2Codec support
   9 ASoC: audio-graph-card2: add Yaml Document
  10 ASoC: sample-custom-card: add Audio Graph Card2 custome sample
  11 ASoC: audio-graph-card2-sample.dtsi: add Sample DT for Audio Graph Card2
  12 ASoC: audio-graph-card2-sample.dtsi: add DPCM sample
  13 ASoC: audio-graph-card2-sample.dtsi: add Multi CPU/Codec sample
  14 ASoC: audio-graph-card2-sample.dtsi: add Codec2Codec sample.

 .../sound/audio-graph-card2-items.yaml        |   80 ++
 .../bindings/sound/audio-graph-card2.yaml     |   51 +
 .../bindings/sound/test-component.yaml        |   33 +
 include/sound/graph_card.h                    |   24 +
 include/sound/simple_card_utils.h             |    4 +
 sound/soc/generic/Kconfig                     |   20 +
 sound/soc/generic/Makefile                    |    6 +
 .../soc/generic/audio-graph-card2-sample.dtsi |  140 ++
 sound/soc/generic/audio-graph-card2.c         | 1252 +++++++++++++++++
 sound/soc/generic/sample-custom-card.c        |  160 +++
 sound/soc/generic/simple-card-utils.c         |   46 +-
 sound/soc/generic/test-component.c            |  659 +++++++++
 12 files changed, 2474 insertions(+), 1 deletion(-)
 create mode 100644 Documentation/devicetree/bindings/sound/audio-graph-card2-items.yaml
 create mode 100644 Documentation/devicetree/bindings/sound/audio-graph-card2.yaml
 create mode 100644 Documentation/devicetree/bindings/sound/test-component.yaml
 create mode 100644 sound/soc/generic/audio-graph-card2-sample.dtsi
 create mode 100644 sound/soc/generic/audio-graph-card2.c
 create mode 100644 sound/soc/generic/sample-custom-card.c
 create mode 100644 sound/soc/generic/test-component.c

-- 
2.25.1

