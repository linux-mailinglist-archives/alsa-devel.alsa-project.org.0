Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 47D2A63D918
	for <lists+alsa-devel@lfdr.de>; Wed, 30 Nov 2022 16:19:17 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id D21C016FF;
	Wed, 30 Nov 2022 16:18:26 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz D21C016FF
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1669821556;
	bh=KFWxVMKII0SXOR46EDi5mFt67WWoxPbmrIwJBVr8Yvs=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=KTnn2AWnxuh5RXha4ENOGf9l09Fz2s1dSK3vHIbUmLSoCFrACVPCBolEKWn5YTEci
	 xZe0tyOKIkujmv7dUCP7k3Az+pzBbYM5yUwfGI8n2yufUYUvfsbQlKA1nCnCx8+LZx
	 DO+Mlg7/gfcKKYPh1RcsJCtkQl6Sfu0CSHSw6Xek=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 96BEAF800B6;
	Wed, 30 Nov 2022 16:18:21 +0100 (CET)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id DEA22F8023A; Wed, 30 Nov 2022 16:18:19 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=-5.1 required=5.0 tests=DKIM_SIGNED,DKIM_VALID,
 DKIM_VALID_AU,RCVD_IN_DNSWL_HI,SPF_HELO_NONE,SPF_PASS,T_SCC_BODY_TEXT_LINE,
 URIBL_BLOCKED,URIBL_DBL_BLOCKED_OPENDNS,URIBL_ZEN_BLOCKED_OPENDNS
 autolearn=disabled version=3.4.0
Received: from smtp-out2.suse.de (smtp-out2.suse.de [195.135.220.29])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id A2F86F80510
 for <alsa-devel@alsa-project.org>; Wed, 30 Nov 2022 16:17:18 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz A2F86F80510
Authentication-Results: alsa1.perex.cz;
 dkim=pass (1024-bit key) header.d=suse.de header.i=@suse.de
 header.b="wLaMJ6LQ"; 
 dkim=permerror (0-bit key) header.d=suse.de header.i=@suse.de
 header.b="Zj4p6sV0"
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de [192.168.254.74])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
 (No client certificate requested)
 by smtp-out2.suse.de (Postfix) with ESMTPS id D5F5B1F37C;
 Wed, 30 Nov 2022 15:17:17 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.de; s=susede2_rsa;
 t=1669821437; h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 in-reply-to:in-reply-to:references:references;
 bh=Dmdw4DCHkR3nvflZZMhPAHzRpIqmAcbTTABThy7ytLM=;
 b=wLaMJ6LQvhHXXvC6mSg8mQro2zwN56l796GoEpA/i2QthN+4eFGVEqOwz3x2y7DWmp75GC
 v08GEIb7v6rYfwbx3Lws2528OEid2TpoLMrBlKaK4xTuNATE39RciOHbbzMz46jQa0cr1V
 IVrNGnG4PFsFpf0GkzLZUxAZDXsGnOY=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.de;
 s=susede2_ed25519; t=1669821437;
 h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 in-reply-to:in-reply-to:references:references;
 bh=Dmdw4DCHkR3nvflZZMhPAHzRpIqmAcbTTABThy7ytLM=;
 b=Zj4p6sV0jsSj2KuKYZaKxRvEzb9sQIYdT11cxIS2SAorKDLzpyWtdN/rlfxFBad0Xcl0o8
 UwkEbY+jwMxCQrDQ==
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de [192.168.254.74])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
 (No client certificate requested)
 by imap2.suse-dmz.suse.de (Postfix) with ESMTPS id B776F1331F;
 Wed, 30 Nov 2022 15:17:17 +0000 (UTC)
Received: from dovecot-director2.suse.de ([192.168.254.65])
 by imap2.suse-dmz.suse.de with ESMTPSA id CJz4K/1zh2NoGwAAMHmgww
 (envelope-from <tiwai@suse.de>); Wed, 30 Nov 2022 15:17:17 +0000
Date: Wed, 30 Nov 2022 16:17:17 +0100
Message-ID: <874jugpj42.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Takashi Sakamoto <o-takashi@sakamocchi.jp>
Subject: Re: [PATCH] ALSA: dice: add support for Focusrite Saffire Pro 40 with
 TCD3070 ASIC
In-Reply-To: <20221130143313.43880-1-o-takashi@sakamocchi.jp>
References: <20221130143313.43880-1-o-takashi@sakamocchi.jp>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) Emacs/27.2 Mule/6.0
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Cc: alsa-devel@alsa-project.org, clemens@ladisch.de
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Wed, 30 Nov 2022 15:33:13 +0100,
Takashi Sakamoto wrote:
> 
> TC Applied Technologies (TCAT) produces TCD3070 as final DICE ASIC for
> communication in IEEE 1394 bus for IEC 61883-1/6 protocol. As long as I
> know, latter model of Focusrite Saffire Pro 40 is an application of the
> ASIC and only in the market for consumers.
> 
> This patchset adds support for the device. The device has several
> remarkable points.
> 
> 1. No support for extended synchronization information section in TCAT
> general protocol. The value of GLOBAL_EXTENDED_STATUS register is always
> zero. Additionally, NOTIFY_EXT_STATUS message is never emitted.
> 
> 2. No support for TCAT protocol extension. Hard coding is required for
> format of CIP payload.
> 
> 3. During several seconds after changing sampling rate, the block to
> process PCM frames is under disfunction. When starting packet streaming
> during the state, the block is never function till configuring different
> sampling rate and several seconds.
> 
> This commit adds support for the device. The item 1 and 2 can be
> adaptable, while item 3 is not. It's not preferable that user process
> is forced to sleep during the disfunction in the call of ioctl(2) with
> SNDRV_PCM_IOCTL_HW_PARAMS or SNDRV_PCM_IOCTL_PREPARE request. It's
> inconvenient but let user configure preferable sampling rate in advance
> of starting PCM substream.
> 
> The content of configuration ROM in the device I used is available at:
>  * https://github.com/takaswie/am-config-roms/
> 
> I note that any mixer control operation is implemented by unique
> transaction. The frame of request consists of 16 bytes header followed
> by payload.
> 
> header (4 quadlets):
> 1st: the type of request, prefixed with 0x8000
> 2nd: counter at 2 bytes in MSB side, the length of data at 2 bytes in LSB
>      side
> 3rd: parameter 0
> 4th: parameter 1
> 
> payload (variable length if need):
> 5th-: data according to parameters
> 
> The request frame is sent by block write request to 0x'ffff'e040'01c0.
> 
> The frame of response is similar to the frame of request, but it is
> header only, thus fixed to 16 bytes. The response frame is sent to the
> address which is registered by lock transaction to 0x'ffff'e040'0008.
> 
> If the operation results in batch of data, the 2nd quadlet of header
> includes the length of data like request. The data is itself readable
> by read block request to 0x'ffff'e040'0030, which includes both
> header and payload for data, thus the length to read should be the
> length of data plus 16 bytes for header
> 
> The actual value of request, parameter 0, parameter 1, and data is
> unclear yet.
> 
> Signed-off-by: Takashi Sakamoto <o-takashi@sakamocchi.jp>

Thanks, applied.


Takashi
