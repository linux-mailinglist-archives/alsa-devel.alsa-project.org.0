Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 00D7EE55D
	for <lists+alsa-devel@lfdr.de>; Mon, 29 Apr 2019 16:51:19 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 69C3B166B;
	Mon, 29 Apr 2019 16:50:28 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 69C3B166B
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1556549478;
	bh=G06nBUoF9pcrxi9JckptVW5pPmv9SvrARRcI69zABRA=;
	h=Date:From:To:In-Reply-To:References:Cc:Subject:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=FWH3QnSQ2FOM91UOnirhofxoEWCseoD+3Kj6z88H/yS0oQfeJL4OuLhgv343yY2M6
	 HuN1Yx9p5IIuWmVJw9OpSD8d8s24nSto2DqTxtkSs98TfiTv4qZL4T4Idc3iiI62cD
	 z4/obNN+25EGGCWP+JUC7AGR/TjYeGZ51wdrZXtw=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 7B2EDF80CAB;
	Mon, 29 Apr 2019 16:49:34 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id BBBDCF80CAB; Mon, 29 Apr 2019 16:49:30 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=-0.0 required=5.0 tests=SPF_PASS autolearn=disabled
 version=3.4.0
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 9205DF80C0D
 for <alsa-devel@alsa-project.org>; Mon, 29 Apr 2019 16:49:27 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 9205DF80C0D
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id B8EF6AF61;
 Mon, 29 Apr 2019 14:49:26 +0000 (UTC)
Date: Mon, 29 Apr 2019 16:49:26 +0200
Message-ID: <s5hpnp4kgsp.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: "Geoffrey D. Bennett" <g@b4.vu>
In-Reply-To: <20190429135602.GA3872@b4.vu>
References: <20190429135602.GA3872@b4.vu>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Cc: alsa-devel@alsa-project.org
Subject: Re: [alsa-devel] [PATCH RFC V2] ALSA: usb-audio: Scarlett Gen 2
	mixer	interface
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Mon, 29 Apr 2019 15:56:02 +0200,
Geoffrey D. Bennett wrote:
> 
> Add mixer quirk for the Focusrite Scarlett 18i8 and 18i20 Gen 2 audio
> interfaces. Although the interfaces are USB compliant, additional
> input/output level controls and hardware routing/mixing functionality
> are available using proprietary USB requests.
> 
> Signed-off-by: Geoffrey D. Bennett <g@b4.vu>
> ---
> Hi all,
> 
> This patch adds the following controls for the Scarlett 18i8 and 18i20
> Gen 2:
> - Master volume knob indicator (18i20 only)
> - Volume controls for the analogue HW outputs
> - HW/SW volume switches for the 10 analogue HW outputs (18i20 only)
> - Output mux (where the sound for the HW outputs comes from; defaults
>   to PCM outputs)
> - Capture mux (where the sound for PCM recording comes from; defaults
>   to HW inputs)
> - Matrix mux (where the sound going into the mixer comes from; 18
>   inputs default off)
> - Mixer matrix (18 inputs * 10 outputs = 180 controls)
> - Mute and dim indicators (18i20 only)
> - Line Level/Instrument Level and Pad controls (18i8 only)
> - Level meters
> 
> Changes since v1:
> - Add support for the Scarlett 18i8 Gen 2
> - Save configuration parameters to NVRAM
> - Implemented feedback from Takashi's email 24/Apr/2019
> - Moved private field from struct snd_usb_audio to struct
>   usb_mixer_interface
> - Added timer and buffer fields to struct usb_mixer_interface
> - Other small code fixes/cleanups/improvements
> 
> Outstanding issues/questions:
> 
> - Adding fields to struct usb_mixer_interface seemed a better place
>   than struct snd_usb_audio as in version 1 of this patch (I think
>   these new fields are used in the same sort of context as the "Sound
>   Blaster remote control stuff" fields, and I am reusing rc_urb and
>   rc_setup_packet). I wasn't sure of the naming; should they be named
>   generically ("timer", "private") or specifically
>   ("scarlett2_buffer")? Should the Sound Blaster RC fields that I'm
>   reusing be renamed to have generic names?

The best would be completely without it, but it's a better place,
indeed.  However, the addition should be only one pointer field
private_data and one function pointer private_free.  Put the all
device specific stuff to private_data and release via the own
private_free callback instead.

> - There are software controllable pads on the 18i8 line-inputs. I
>   called the controls "Line In %d Pad Capture Switch". They work
>   correctly in alsamixer (shown in the capture view as e.g. "Line In 1
>   Pad") but the "on" state is displayed as "L R CAPTURE" which looks
>   unusual. I could use an Enum with Off/On values, but I thought this
>   is what "Switch" is for (as per control-names.rst). Should I leave
>   this as-is, or is there a better name that will make this show up as
>   a regular on/off switch?
> 
>   amixer contents shows:
> 
>   numid=15,iface=MIXER,name='Line In 1 Pad Capture Switch'
>     ; type=BOOLEAN,access=rw------,values=1
>     : values=off
> 
>   amixer scontents shows:
> 
>   Simple mixer control 'Line In 1 Pad',0
>     Capabilities: cswitch cswitch-joined
>     Capture channels: Mono
>     Mono: Capture [off]

It's possible to override per device-specific stuff via a
shared-object plugin in alsa-lib, but this is far too complex.
Rather leave it as is.  alsamixer isn't the best tool for a
complicated mixer UI, after all.

About the other changes:
a timer is no suitable choice for such a purpose.  The easier option
would be the delayed work.  Then you can use GFP_KERNEL instead of
GFP_ATOMIC.

Also, the delayed work needs to be canceled or flushed at PM suspend
callback as well as disconnecting.


thanks,

Takashi
_______________________________________________
Alsa-devel mailing list
Alsa-devel@alsa-project.org
https://mailman.alsa-project.org/mailman/listinfo/alsa-devel
