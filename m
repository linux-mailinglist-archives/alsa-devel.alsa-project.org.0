Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 812C63893D3
	for <lists+alsa-devel@lfdr.de>; Wed, 19 May 2021 18:33:52 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 170E2167C;
	Wed, 19 May 2021 18:33:02 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 170E2167C
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1621442032;
	bh=sDsElK7p5Obl/Ju53Lqf4oNje1G4QwvggmyggUSJbuw=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=UCDX+jIFG5Pyno96Ryj8RY6oHhdjdzUGK8zs4P91rZUa4gTsDW9SdMTsrwL1K2jhT
	 Lc0VFrHY0VVJvGv8kYTOyCODwHo+snhLJcf5GKPU0YLZaiBRG8iriA5NuLGwzeLBHt
	 Yy6rupchDK28kDwWdG2MrB7p7nt5/p+wt8Gk911M=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 8B166F80246;
	Wed, 19 May 2021 18:32:22 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id CE552F8016E; Wed, 19 May 2021 18:32:20 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_NONE
 autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 30FD5F8014C
 for <alsa-devel@alsa-project.org>; Wed, 19 May 2021 18:32:15 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 30FD5F8014C
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id 14B0DB20F;
 Wed, 19 May 2021 16:32:15 +0000 (UTC)
Date: Wed, 19 May 2021 18:32:15 +0200
Message-ID: <s5hy2cahegg.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: "re.mcclue" <re.mcclue@protonmail.com>
Subject: Re: Intel HDA Driver Issue With PCM RW Interleaved
In-Reply-To: <3GXvg2z0sYlmlwylckstDNNXwCFBbCbPmclFAPK-zN6DMEdtpCMZFcNRVpCSGt9IccFbdl8ci5_hRe92wTsFpbwCEpLMAr3Yg4D60LjEbyU=@protonmail.com>
References: <3GXvg2z0sYlmlwylckstDNNXwCFBbCbPmclFAPK-zN6DMEdtpCMZFcNRVpCSGt9IccFbdl8ci5_hRe92wTsFpbwCEpLMAr3Yg4D60LjEbyU=@protonmail.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: alsa-devel@alsa-project.org
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Wed, 19 May 2021 07:48:52 +0200,
re.mcclue wrote:
> 
> I'm trying to play PCM buffer single threaded without buffer underrun.
> Program source: https://gist.github.com/takaswie/d8a9553c230971d974a3dfc759b2ff67
> (struct snd_pcm_sw_params).start_threshold is altered so as to allow specifying the start of audio frame transmission and prevent underrun issues.
> In my application, on ioctl(fd, SNDRV_PCM_IOCTL_STATUS, &status), I receive: File descriptor in bad state
> Output of $(dmesg) is: [ 69.013084] snd_hda_intel 0000:00:1f.3: Too big adjustment 128
> What is causing this issue and how can I solve it?

The warning message is likely a red herring and it's irrelevant from
your bug itself.  The driver has some small number of periods to be
put at the beginning of the buffer for correcting the reported
position.  Judging from the message, you seem to have set a quite high
rate and a very shot number, and that's possibly too tight to operate
properly.


Takashi
