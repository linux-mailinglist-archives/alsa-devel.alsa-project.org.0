Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 0052436E7C8
	for <lists+alsa-devel@lfdr.de>; Thu, 29 Apr 2021 11:17:00 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id A7C901689;
	Thu, 29 Apr 2021 11:16:07 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz A7C901689
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1619687817;
	bh=g+eMJ/feQvQFYaQeMEskADKmEqEk1bgsnb54YWo/bRw=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=RhRgNVAZVr0lzo/xQiVbWWQpiJNf/LWfaoaNg83KFNwGqttc/TYqVROgHA6gX1pUV
	 S75GkQV+tQo9aE7pS9yuiN2644bAvljRmVlki0hl36130zJiKrA7qcRTADullvmUag
	 Q+eaJD0xOedlkkjfDNm3I5RwP2m2YFNDegOXaL7Y=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 416A7F801ED;
	Thu, 29 Apr 2021 11:15:28 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id D48B8F801EC; Thu, 29 Apr 2021 11:15:25 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_NONE,
 URIBL_BLOCKED autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 2FCCCF80117
 for <alsa-devel@alsa-project.org>; Thu, 29 Apr 2021 11:15:11 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 2FCCCF80117
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id AB4A3AFD5;
 Thu, 29 Apr 2021 09:15:11 +0000 (UTC)
Date: Thu, 29 Apr 2021 11:15:11 +0200
Message-ID: <s5hczudwixs.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Lucas <jaffa225man@gmail.com>
Subject: Re: [PATCH 2/2] ALSA: usb-audio: Generic application of implicit fb
 to Roland/BOSS devices
In-Reply-To: <CAOsVg8o2Ad0pZK2qrLq8=NfJYd-1swveyhrmtPN8995m-dBoKg@mail.gmail.com>
References: <20210422120413.457-1-tiwai@suse.de>
 <20210422120413.457-2-tiwai@suse.de>
 <CAHXb3bcKvPSceMuvrq-X8dUyxdrH6iAHTHq_RgTXoAAiXygwUQ@mail.gmail.com>
 <CAOsVg8rAkwLgLP_LSj6CfYG+1R2oB5-sV4KQhLJMqCEqL2wDQA@mail.gmail.com>
 <s5hlf99788o.wl-tiwai@suse.de>
 <CAOsVg8rPfh-scSmmJSVASPTw7o3vw_zZ05YzVZ_JYFJHbcOcyg@mail.gmail.com>
 <s5hlf964td3.wl-tiwai@suse.de>
 <CAOsVg8okhRKPSnSOOCjMMD4wBxFB=E1i7JaQQY0T+CfCa_Jz1g@mail.gmail.com>
 <s5him494kqr.wl-tiwai@suse.de>
 <CAOsVg8o2Ad0pZK2qrLq8=NfJYd-1swveyhrmtPN8995m-dBoKg@mail.gmail.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Cc: alsa-devel@alsa-project.org, "Keith A . Milner" <maillist@superlative.org>,
 Mike Oliphant <oliphant@nostatic.org>
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Wed, 28 Apr 2021 23:43:30 +0200,
Lucas wrote:
> On Mon, Apr 26, 2021 at 1:34 AM Takashi Iwai <tiwai@suse.de> wrote:
>     On Sun, 25 Apr 2021 21:23:31 +0200,
>     Lucas wrote:
>     > Although unrelated, I think the other issue with the EIDROL UA-101 in
>     full
>     > speed mode (USB 1.1) is new since trying the 5.12.0-rc8-next-20210422
>     kernel
>     > branch.  Prior to that, I'd been continually patching updates to the
>     mainline
>     > 5.11.9 source.
>    
>     Hm, let me know if you find more details.
> 
> The kernel option "snd_ua101.dyndbg=+p" debugging details seem lacking here,
> so this is the little I was able to gather:
> 
> The Edirol UA-101's full speed (USB 1.1) mode is affected, but not its high
> speed (USB 2) mode, which works under these same conditions.
> 
> It only misbehaves on my USB2 ports, not my other availability of USB3.
> On a working older kernel 5.9.0-1-rt-amd64 with the dyndbg above enabled, I
> got a very sparse debugging log:
> 3:43:00 turned it on (already switched to full speed mode-USB 1.1, & already
> connected to a USB2 port)
> 
> [  185.018174] usb 3-1.5: new full-speed USB device number 3 using ehci-pci
> [  185.129040] usb 3-1.5: New USB device found, idVendor=0582, idProduct=008d,
> bcdDevice= 1.03
> [  185.129046] usb 3-1.5: New USB device strings: Mfr=1, Product=2,
> SerialNumber=3
> [  185.129048] usb 3-1.5: Product: UA-101 USB1
> [  185.129050] usb 3-1.5: Manufacturer: EDIROL
> [  185.129052] usb 3-1.5: SerialNumber: AX85615
> 
> 3:45:00 arecord -D plughw:USB1 -f S24_3LE -r 48000 -c 2 ./file.wav
> Recording WAVE './file.wav' : Signed 24 bit Little Endian in 3bytes, Rate
> 48000 Hz, Stereo
> 
> 3:47:20 ended with ctrl-c
> ^CAborted by signal Interrupt...
> 
> 3:50:00 aplay -D plughw:USB1 -f S24_3LE -r 48000 -c 2 ./file.wav
> Playing WAVE './file.wav' : Signed 24 bit Little Endian in 3bytes, Rate 48000
> Hz, Stereo
> 
> 3:52:03 playback ended normally
> 
> 3:54:30 disconnected the USB cable
> 
> [  872.498057] usb 3-1.5: USB disconnect, device number 3
> 
> Now here's the same tests with kernel 5.12.0-rc8-next-20210422, still with
> boot option "snd_ua101.dyndbg=+p".  Note the alsa device name changed from
> "USB1" on the old kernel to UA101" here, but I doubt that makes the
> difference:
> 
> 2:12:30 turned it on (already connected to a USB2 port, probably the same
> port, though its designation changed)
> 
> [  163.133264] usb 4-1.5: new full-speed USB device number 3 using ehci-pci
> [  163.244115] usb 4-1.5: New USB device found, idVendor=0582, idProduct=008d,
> bcdDevice= 1.03
> [  163.244126] usb 4-1.5: New USB device strings: Mfr=1, Product=2,
> SerialNumber=3
> [  163.244130] usb 4-1.5: Product: UA-101 USB1
> [  163.244133] usb 4-1.5: Manufacturer: EDIROL
> [  163.244135] usb 4-1.5: SerialNumber: AX85615
> [  163.263127] usbcore: registered new interface driver snd-ua101
> [  168.476496] usb 4-1.5: cannot initialize interface; error -110: unknown
> error
> [  173.596462] usb 4-1.5: cannot initialize interface; error -110: unknown
> error
> [  178.716557] usb 4-1.5: cannot initialize interface; error -110: unknown
> error
> [  183.836518] usb 4-1.5: cannot initialize interface; error -110: unknown
> error
> 
> 2:13:00 arecord -D plughw:UA101 -f S24_3LE -r 48000 -c 2 ./file.wav
> arecord: main:830: audio open error: Connection timed out
> 
> [  188.956481] usb 4-1.5: cannot initialize interface; error -110: unknown
> error
> [  194.076450] usb 4-1.5: cannot initialize interface; error -110: unknown
> error
> [  199.196407] usb 4-1.5: cannot initialize interface; error -110: unknown
> error
> 
> 2:14:30 aplay -D plughw:UA101 -f S24_3LE -r 48000 -c 2 ./Music/
> test-kernel-5.11.9-patched-integra-7-usb-digital-audio-all-6-demos.wav
> 
> [  285.979938] usb 4-1.5: cannot initialize interface; error -110: unknown
> error
> 
> after a few seconds:
> aplay: main:830: audio open error: Connection timed out
> 
> 2:17:19 turned it off
> 
> [  447.489736] usb 4-1.5: USB disconnect, device number 3
> 
> Then, here, I connected it to a USB3 port (which works):
> 
> 2:21:00 turned it on
> 
> [  671.310730] usb 1-1.2: new full-speed USB device number 5 using xhci_hcd
> [  671.413736] usb 1-1.2: New USB device found, idVendor=0582, idProduct=008d,
> bcdDevice= 1.03
> [  671.413747] usb 1-1.2: New USB device strings: Mfr=1, Product=2,
> SerialNumber=3
> [  671.413751] usb 1-1.2: Product: UA-101 USB1
> [  671.413754] usb 1-1.2: Manufacturer: EDIROL
> [  671.413757] usb 1-1.2: SerialNumber: AX85615
> 
> 2:22:00 arecord -D plughw:UA101 -f S24_3LE -r 48000 -c 2 ./file.wav
> Recording WAVE './file.wav' : Signed 24 bit Little Endian in 3bytes, Rate
> 48000 Hz, Stereo
> 
> 2:26:09 ended it with ctrl-c
> ^CAborted by signal Interrupt...
> 
> 2:27:30 aplay -D plughw:UA101 -f S24_3LE -r 48000 -c 2 ./file.wav
> Playing WAVE './file.wav' : Signed 24 bit Little Endian in 3bytes, Rate 48000
> Hz, Stereo
> 
> 2:31:40 playback ended normally
> 
> 2:33:00 disconnected it
> 
> [ 1390.570021] usb 1-1.2: USB disconnect, device number 5
> 
> Later, I turned it off, changed switch to high speed (USB 2) mode (which
> works), and plugged it back in to that same USB2 port with the trouble
> earlier:
> 
> 2:47:00 turned it on
> 
> [ 2231.706964] usb 4-1.5: new high-speed USB device number 8 using ehci-pci
> [ 2231.817266] usb 4-1.5: New USB device found, idVendor=0582, idProduct=007d,
> bcdDevice= 1.03
> [ 2231.817277] usb 4-1.5: New USB device strings: Mfr=1, Product=2,
> SerialNumber=3
> [ 2231.817281] usb 4-1.5: Product: UA-101
> [ 2231.817284] usb 4-1.5: Manufacturer: EDIROL
> [ 2231.817287] usb 4-1.5: SerialNumber: AX85615
> 
> 2:47:30 arecord -D plughw:UA101 -f S24_3LE -r 48000 -c 2 ./file.wav
> Recording WAVE './file.wav' : Signed 24 bit Little Endian in 3bytes, Rate
> 48000 Hz, Stereo
> 
> 2:48:30 ended recording with ctl-c
> ^CAborted by signal Interrupt...
> 
> 2:50:00 turned it off
> 
> [ 2412.517175] usb 4-1.5: USB disconnect, device number 8
> 
> Sorry if that's not enough information; it certainly seems bare to me.  I'd be
> happy if you have other suggestions that could lead to better diagnosis,
> though.

The error -110 is ETIMEDOUT, and the symptom implies that the problem
is rather in USB core side.  You'd better ask USB devs.  It might be
worth to run git bisect if it's a kernel regression and reliably
reproducible.


thanks,

Takashi
