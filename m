Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 08E8613E44
	for <lists+alsa-devel@lfdr.de>; Sun,  5 May 2019 09:51:35 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 7F01C18BC;
	Sun,  5 May 2019 09:50:44 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 7F01C18BC
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1557042694;
	bh=KwCDbl9me5zV+jVqi0Dg2Z1SZ6o5xFzx1jw6lpXIvLQ=;
	h=Date:From:To:In-Reply-To:References:Cc:Subject:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=bY6NMiIfq3cVihKs6uJdpzq0WGvTnBp+Tmuw5i9IO/VMXUsxCaMlnHCQC8FZJe6P6
	 9xhL9DqnEhCUhT6lhP/P40kD6mMDmlwUYXY1/xYeQEuQ+gzXunuImDVitnYks7+Bu3
	 2UENp/xEt8duZL9S+A/YDcahJUMSF0IqCQN7LyeM=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 92D33F89682;
	Sun,  5 May 2019 09:49:50 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 415D5F89674; Sun,  5 May 2019 09:49:45 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_PASS,URIBL_BLOCKED
 autolearn=disabled version=3.4.0
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id AEABBF8071D
 for <alsa-devel@alsa-project.org>; Sun,  5 May 2019 09:49:41 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz AEABBF8071D
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 38FB5AD17;
 Sun,  5 May 2019 07:49:41 +0000 (UTC)
Date: Sun, 05 May 2019 09:49:41 +0200
Message-ID: <s5hd0kxl4ru.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Rob van der Putten <rob@sput.nl>
In-Reply-To: <qak1t9$4vqg$1@blaine.gmane.org>
References: <q9nlbm$3kqm$1@blaine.gmane.org> <s5h1s1mmudg.wl-tiwai@suse.de>
 <qak1t9$4vqg$1@blaine.gmane.org>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Cc: alsa-devel@alsa-project.org
Subject: Re: [alsa-devel] [PATCH] Aseqnet, no nagle and dual stack
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Sat, 04 May 2019 14:51:53 +0200,
Rob van der Putten wrote:
> 
> Hi there
> 
> 
> On 28/04/2019 10:00, Takashi Iwai wrote:
> 
> > On Tue, 23 Apr 2019 20:25:58 +0200,
> > Rob van der Putten wrote:
> > On Tue, 23 Apr 2019 20:25:58 +0200,
> > Rob van der Putten wrote:
> >>
> >> Hi there
> >>
> >>
> >> Not an ALSA source patch, but a patch for an ALSA related util.
> >> Aseqnet sends ALSA sound_seq MIDI over TCP/IP. The patch below
> >> disables nagle, enables quickack and makes aseqnet dual-stack.
> >
> > Thanks for the patch.  Could you repost with a proper patch change log
> > and your Signed-off-by line so that one can apply to git repo?
> 
> Added
> - Disabled Nagle's algorithm
> - Enbled quickack
> - IPv6 support
> 
> Signed-off-by: Rob van der Putten <rob@sput.nl>
> 
> > About the changes:
> >> --- aseqnet.c.bak	2012-01-25 10:43:38.000000000 +0100
> >> +++ aseqnet.c	2017-08-26 14:17:58.261868853 +0200
> >> @@ -3,6 +3,8 @@
> >>    *   ver.0.1
> >>    *
> >>    * Copyright (C) 1999-2000 Takashi Iwai
> >> + * Modified by Rob van der Putten, Leiden, Holland,
> >> + * rob at sput dot nl.
> >
> > We don't need to add each change in the source like that as all
> > tracked in git.
> >
> >> @@ -15,18 +17,21 @@
> >>    *
> >>    */
> >>
> >> +#include <alsa/asoundlib.h>
> >> +#include <arpa/inet.h>
> >> +#include <assert.h>
> >> +#include <ctype.h>
> >> +#include <getopt.h>
> >> +#include <locale.h>
> >> +#include <netdb.h>
> >> +#include <netinet/in.h>
> >> +#include <netinet/tcp.h>
> >> +#include <signal.h>
> >>   #include <stdio.h>
> >>   #include <stdlib.h>
> >> -#include <ctype.h>
> >>   #include <string.h>
> >> -#include <netinet/in.h>
> >>   #include <sys/socket.h>
> >> -#include <netdb.h>
> >> -#include <locale.h>
> >> -#include <alsa/asoundlib.h>
> >> -#include <getopt.h>
> >> -#include <signal.h>
> >> -#include <assert.h>
> >> +#include <sys/types.h>
> >>   #include "aconfig.h"
> >>   #include "gettext.h"
> >
> > Why these large rearrangement of include files?  If it must be
> > inevitably done, please describe the reason in the changelog, too.
> 
> I just put them into alphabetical order. I changed that back.
> 
> >> @@ -327,17 +332,24 @@
> >>    */
> >>   static void init_server(int port)
> >>   {
> >> +	/*
> >> +	*       RvdP, changed to support IPv6
> >> +	*       Dual stack only!
> >> +	*/
> >
> > Wouldn't it potentially break things?  IMO, it's better to keep the
> > old behavior (ipv4-only), at least, with an option.
> 
> Server:
> The behaviour is determined by /proc/sys/net/ipv6/bindv6only
> If this is one, the listening socket will be IPv6 only instead of dual
> stack. A socket option is used to set IPV6_V6ONLY to zero, which
> forces the listening socket dual stack.
> 
> Client:
> The 'for (rp = result; rp != NULL; rp = rp->ai_next) {' loop keeps
> trying to connect to the remote host: If IPv6 fails, it uses IPv4
> instead.
> 
> Both:
> I added a -4 / --ipv4 option.
> This not in the previous patch.
> It also introduces the string '-4, --ipv4 : IPv4 only' for which there
> no translations. And a new bit in the man page, with an added man page
> patch.
> 
> > Also, drop your initials in the commit, it's rather superfluous.
> 
> A new aseqnet patch. Note: This patches the original, not the previous
> patch.

Thanks, the code changes look much better now!
But the patch embedded in your mail is broken because of your MUA that
breaks lines.  Please either fix your MUA setup or use an attachment
if it's difficult.

Also, please give the patch description along with your sign-off
line.  That is, at best, please send a patch in the form that is
applicable via git-am.


thanks,

Takashi
_______________________________________________
Alsa-devel mailing list
Alsa-devel@alsa-project.org
https://mailman.alsa-project.org/mailman/listinfo/alsa-devel
