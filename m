Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 25C8635C2FF
	for <lists+alsa-devel@lfdr.de>; Mon, 12 Apr 2021 12:06:00 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 8DE62166B;
	Mon, 12 Apr 2021 12:05:09 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 8DE62166B
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1618221959;
	bh=BxGRNp0WJ2qTV8kxsssc171kArEuohETDuxiHJdSTgI=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=QGk1U1I1iMXiQNL0MRxpMQ37so4LrLq7kywX7gsfrQds2njeTKTT+vBv3bW3L1wn5
	 kK3ArM3vfhV+KhAOr3API4XV8YRPCAk/cbMWmeGjcEqkjDakLbhcIq4lRRM0L18M28
	 H776fiDU2HWzk87L4CI3EJPEDsWiWJ4iZuwQc//A=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id CB3FFF800D3;
	Mon, 12 Apr 2021 12:05:07 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 0B723F80273; Mon, 12 Apr 2021 12:05:06 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_NONE
 autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 4B709F8025B
 for <alsa-devel@alsa-project.org>; Mon, 12 Apr 2021 12:04:58 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 4B709F8025B
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id F2788AF1A;
 Mon, 12 Apr 2021 10:04:57 +0000 (UTC)
Date: Mon, 12 Apr 2021 12:04:57 +0200
Message-ID: <s5hfszv3jjq.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Jaroslav Kysela <perex@perex.cz>
Subject: Re: [PATCH v4] sound: rawmidi: Add framing mode
In-Reply-To: <822b7ebf-71ac-2f84-731d-65e772eea1ff@perex.cz>
References: <20210410120229.1172054-1-coding@diwic.se>
 <df8cc177-f91d-28b1-c8df-1162dc136657@perex.cz>
 <bb91fc79-1b61-b051-1543-b5c8b1633fb3@diwic.se>
 <87f906a5-b77f-d3e8-29d7-7ce6e35c452a@perex.cz>
 <s5hk0p73l36.wl-tiwai@suse.de>
 <822b7ebf-71ac-2f84-731d-65e772eea1ff@perex.cz>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: alsa-devel@alsa-project.org, David Henningsson <coding@diwic.se>
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Mon, 12 Apr 2021 11:43:02 +0200,
Jaroslav Kysela wrote:
> 
> Dne 12. 04. 21 v 11:31 Takashi Iwai napsal(a):
> > On Sun, 11 Apr 2021 19:52:21 +0200,
> > Jaroslav Kysela wrote:
> >>>>>   struct snd_rawmidi_params {
> >>>>>   	int stream;
> >>>>>   	size_t buffer_size;		/* queue size in bytes */
> >>>>>   	size_t avail_min;		/* minimum avail bytes for wakeup */
> >>>>>   	unsigned int no_active_sensing: 1; /* do not send active sensing byte in close() */
> >>>>> -	unsigned char reserved[16];	/* reserved for future use */
> >>>>> +	unsigned char framing;		/* For input data only, frame incoming data */
> >>>> We can move this flag to above 32-bit word (no_active_sensing). I'm not sure,
> >>>> if we need 8 bits for this. It's first change after 20 years. Another flag may
> >>>> obsolete this one.
> >>>
> >>> Not sure what you mean by this, could you show the code? Framing is an 
> >>> enum rather than a flag, in case we find other framing formats with 
> >>> other sizes that would obsolete this one.
> >>
> >> unsigned int no_active_sensing: 1;
> >> unsigned int framing32: 1;
> >> unsigned int framing64: 1; /* future extension, framing32 == 0 in this case */
> >>
> >> or:
> >>
> >> unsigned int framing_mode: 3;	/* three bits for future types */
> >>
> >> perhaps also:
> >>
> >> unsigned int clock_type: 3;	/* three bits for the clock type selection */
> > 
> > The usage of bit fields in an ioctl struct is a bad idea from the
> > compat layer POV.  Let's avoid it.
> 
> What exactly do you mean?

The compat layer has the hard time to deal with the conversion of bit
fields to a different struct.  And, it's a nightmare for the emulator
like QEMU.  If it has to convert the ioctl struct, it has to consider
about the byte order as well (and there is no strict definition how to
put the bit fields in C language).

That said, a bit field can be useful for the internal object
definition (if there is no racy access), but not for an object for the
communication that may be interpreted among different architectures.


Takashi
