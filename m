Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 995C21170FD
	for <lists+alsa-devel@lfdr.de>; Mon,  9 Dec 2019 16:59:59 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 3371310E;
	Mon,  9 Dec 2019 16:59:09 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 3371310E
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1575907199;
	bh=PIKINXKZLjq4Fh8E9vLXJyBUY3+PMucvlOp6epc8PxI=;
	h=Date:From:To:In-Reply-To:References:Cc:Subject:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=EKRg0W/bsYlgTHLXmEJymsjLZ4b0dXAfogFsWwUEyBni7DvzirX7Sqgzb5JbpnRyI
	 IfTgiT8mLP7Na7HUlZUjypRGwte68l7eeJildwA4c9qJKX3DUQZmqL6qrDLOlKuoR2
	 1+w5dAd/e8cNf3D+Uzc24vcj1NU4UwCbNK3n4/RE=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id ADE7BF8011E;
	Mon,  9 Dec 2019 16:58:15 +0100 (CET)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id C699DF800E1; Mon,  9 Dec 2019 16:58:07 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_PASS
 autolearn=disabled version=3.4.0
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id DA338F800E1
 for <alsa-devel@alsa-project.org>; Mon,  9 Dec 2019 16:58:04 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz DA338F800E1
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 0CD68AD93;
 Mon,  9 Dec 2019 15:58:03 +0000 (UTC)
Date: Mon, 09 Dec 2019 16:58:02 +0100
Message-ID: <s5hwob5cwz9.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Takashi Sakamoto <o-takashi@sakamocchi.jp>
In-Reply-To: <20191209151655.GA8090@workstation>
References: <20191209094943.14984-1-tiwai@suse.de>
 <20191209094943.14984-10-tiwai@suse.de>
 <20191209151655.GA8090@workstation>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Cc: alsa-devel@alsa-project.org
Subject: Re: [alsa-devel] [PATCH 5.6 09/71] ALSA: firewire: Use managed
	buffer allocation
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Mon, 09 Dec 2019 16:16:56 +0100,
Takashi Sakamoto wrote:
> 
> Hi,
> 
> I'm not opposed to this patchset. The direction is preferable.
> 
> However changes in this patchset brings bugs in error path of
> each implementation for pcm.hw_params.
> 
> On Mon, Dec 09, 2019 at 10:48:41AM +0100, Takashi Iwai wrote:
> > diff --git a/sound/firewire/bebob/bebob_pcm.c b/sound/firewire/bebob/bebob_pcm.c
> > index d4edd06d32cf..2ee91ff6891e 100644
> > --- a/sound/firewire/bebob/bebob_pcm.c
> > +++ b/sound/firewire/bebob/bebob_pcm.c
> > @@ -214,10 +214,6 @@ static int pcm_hw_params(struct snd_pcm_substream *substream,
> >  	struct snd_bebob *bebob = substream->private_data;
> >  	int err;
> >  
> > -	err = snd_pcm_lib_malloc_pages(substream, params_buffer_bytes(hw_params));
> > -	if (err < 0)
> > -		return err;
> > -
> >  	if (substream->runtime->status->state == SNDRV_PCM_STATE_OPEN) {
> >  		unsigned int rate = params_rate(hw_params);
> >  		unsigned int frames_per_period = params_period_size(hw_params);
> > @@ -231,7 +227,7 @@ static int pcm_hw_params(struct snd_pcm_substream *substream,
> >  		mutex_unlock(&bebob->mutex);
> >  	}
> >  
> > -	return err;
> > +	return 0;
> >  }
>   
> This should return the err variable to report failure of isochronous
> resources reservation.
> 
> However I found that ALSA oxfw/fireface drivers returns 0 even if it
> fails. This is bug since v5.3 kernel.
> 
> Would you please apply below two patches into your three, then modify
> your patch for all firewire drivers to return error correctly?

Yes, that sounds like a correct fix.  Thank you for spotting out.

So, please go ahead, submit these two patches, then I'll update the
fix containing your correction above and submit as v2 (maybe only for
this, as the whole series is too big to re-submit).


Takashi
_______________________________________________
Alsa-devel mailing list
Alsa-devel@alsa-project.org
https://mailman.alsa-project.org/mailman/listinfo/alsa-devel
