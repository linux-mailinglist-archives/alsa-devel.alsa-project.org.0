Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id DD245675437
	for <lists+alsa-devel@lfdr.de>; Fri, 20 Jan 2023 13:11:33 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher ADH-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 7103931CA;
	Fri, 20 Jan 2023 13:10:43 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 7103931CA
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1674216693;
	bh=/04hQlZBbYWx+35NJ6zIsaqmxa83rpr2E3FGWoY7FLo=;
	h=Date:From:To:Subject:In-Reply-To:References:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 Cc:From;
	b=Yq0/5I/3edsN3j/pszVBqty/l09aC7vvrFPU7du9wOW9LqXeJ89HwCC3xgDS8bsT9
	 asbFuAypsZjG0xdn3uw7hScYVP21gb0+Sf2MRXJHf5kqpLIXR2FSMD2EjNPSWTwu52
	 B6gtmYrg8a7cL9wKxj4/nI74KDHbKY6Qyl617G3E=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 34962F800F0;
	Fri, 20 Jan 2023 13:10:37 +0100 (CET)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 093D1F8024D; Fri, 20 Jan 2023 13:10:35 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=-5.2 required=5.0 tests=DKIM_SIGNED,DKIM_VALID,
 DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_HI,SPF_HELO_NONE,SPF_PASS,
 URIBL_BLOCKED shortcircuit=no autolearn=ham autolearn_force=no
 version=3.4.6
Received: from smtp-out1.suse.de (smtp-out1.suse.de [IPv6:2001:67c:2178:6::1c])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature RSA-PSS (4096 bits) server-digest SHA256)
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id EDFFDF800F0
 for <alsa-devel@alsa-project.org>; Fri, 20 Jan 2023 13:10:31 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz EDFFDF800F0
Authentication-Results: alsa1.perex.cz;
 dkim=pass (1024-bit key, unprotected) header.d=suse.de header.i=@suse.de
 header.a=rsa-sha256 header.s=susede2_rsa header.b=o/C+6Mh3; 
 dkim=pass header.d=suse.de header.i=@suse.de header.a=ed25519-sha256
 header.s=susede2_ed25519 header.b=9leN01Ea
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de [192.168.254.74])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
 (No client certificate requested)
 by smtp-out1.suse.de (Postfix) with ESMTPS id 660F321CFB;
 Fri, 20 Jan 2023 12:10:31 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.de; s=susede2_rsa;
 t=1674216631; h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 in-reply-to:in-reply-to:references:references;
 bh=BvmabtLkUJGBDuww6d8rSwlZ5xoLyZVCIVffHELl9Bg=;
 b=o/C+6Mh3ROVjMqONKdcNKZkld0cWAPrehb95GJr9fHT36feTtWKfHhV4QbpTG9bNq+VHbb
 YnlGPy8O2kkefpunvyGfFb7WlYCGpbBr0lztEkW82RgCDwdEPWw16GSnqKOnm0p7T8xfY0
 bZH8SEfOYGfZ42lmCNoENt4ZvVqRgNs=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.de;
 s=susede2_ed25519; t=1674216631;
 h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 in-reply-to:in-reply-to:references:references;
 bh=BvmabtLkUJGBDuww6d8rSwlZ5xoLyZVCIVffHELl9Bg=;
 b=9leN01EaRqm/GWfvTKOzOm7Nc/gu6GRvtVOX0qlGDRWr09cdXtaPssO+Ahwok4Tp7jxLgv
 WWmIqHXwlluCYMCg==
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de [192.168.254.74])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
 (No client certificate requested)
 by imap2.suse-dmz.suse.de (Postfix) with ESMTPS id 4B3F61390C;
 Fri, 20 Jan 2023 12:10:31 +0000 (UTC)
Received: from dovecot-director2.suse.de ([192.168.254.65])
 by imap2.suse-dmz.suse.de with ESMTPSA id xleaEbeEymOLDwAAMHmgww
 (envelope-from <tiwai@suse.de>); Fri, 20 Jan 2023 12:10:31 +0000
Date: Fri, 20 Jan 2023 13:10:30 +0100
Message-ID: <87bkmtpft5.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Mike FABIAN <mfabian@redhat.com>
Subject: Re: No sound on HDMI by default on Lenovo T14s using Fedora 37
In-Reply-To: <s9dbkmtigfe.fsf@hathi.site>
References: <s9dy1pzx3ki.fsf@hathi.site> <87k01j6cw6.wl-tiwai@suse.de>
 <s9dfsc7ixik.fsf@hathi.site> <877cxj65s3.wl-tiwai@suse.de>
 <87zgaerfqv.wl-tiwai@suse.de> <s9dbkmtigfe.fsf@hathi.site>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) Emacs/27.2 Mule/6.0
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=ISO-2022-JP
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Cc: alsa-devel@alsa-project.org, Takashi Iwai <tiwai@suse.com>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Fri, 20 Jan 2023 12:39:01 +0100,
Mike FABIAN wrote:
> 
> Takashi Iwai <tiwai@suse.de> さんはかきました:
> 
> >> And, with this state, can you use the built-in mic?  Also, how after
> >> restoring the module option?
> 
> Yes, I can use the microphone built into the laptop. I think I can use
> that always, independent on whether I use the module option or not.

Aha, then that's a different system from what I've thought.
The mic is routed apparently via Intel SOF driver.

> > Also, maybe more fundamental question: how exactly "it didn't work"?
> > Does the HDMI device appear on pipewire / PulseAudio, but the output
> > results in silence?  Or Is no HDMI listed there?
> 
> HDMI is listed in pavucontrol.
> 
> Actually it is listed there 3 times:
> 
>     HDMI/Displayport 3 Output (unplugged)
>     HDMI/Displayport 2 Output (unplugged)
>     HDMI/Displayport 1 Output (plugged in)
> 
> But when I select it, I heards nothing from the monitor speakers.
> I tried all 3 HDMI/Displayport in pavucontrol because I was not sure
> which one was the right one, but I didn’t hear anything when trying to
> use any of them.
> 
> xrandr showed me the following outputs:
> 
>     $ xrandr | grep connected
>     eDP-1 connected primary 1920x1080+0+0 (normal left inverted right x axis y axis) 309mm x 174mm
>     HDMI-1 disconnected (normal left inverted right x axis y axis)
>     DP-1 disconnected (normal left inverted right x axis y axis)
>     DP-2 disconnected (normal left inverted right x axis y axis)
>     DP-3 disconnected (normal left inverted right x axis y axis)
>     DP-4 disconnected (normal left inverted right x axis y axis)
>     DP-3-1 disconnected (normal left inverted right x axis y axis)
>     DP-3-2 disconnected (normal left inverted right x axis y axis)
>     DP-3-3 connected 3840x2160+1920+0 (normal left inverted right x axis y axis) 600mm x 340mm
> 
> DP-3-3 is my external monitor which has speakers.

Please check /proc/asound/card0/eld#* (for the card number 0, as
found in /proc/asound/cards as sof-hda-dsp).  One of them should have
a valid ELD entry.  This is the first step.  If no proper monitor and
ELD is found in those, something wrong at the detection in the
kernel.

The next is to test aplay directly with the device.
"aplay -L" will show the possible option, and you can try like

  % apaly -Dhdmi:CARD=xxx,DEV=x -vv foo.wav

for a WAV file in a format matching with the supported device
(typically 2 channel stereo 44.1kHz or 48kHz 16 or 32bit format).
If this gets a busy error, stop wireplumber once during the test:
  % systemctl --user stop wireplumber
  % aplay ....
  % systemctl --user start wireplumber

If the aplay test doesn't work, again, it means that there's something
wrong in the kernel.

> After I did set that module option with modprobe and rebooted, I could
> select
> 
>     HDMI/Displayport 1 Output (plugged in)
> 
> in pavucontrol and hear sound from the monitor speakers. So what xrandr
> calls DP-3-3 seems to be HDMI/Displayport 1 (plugged in) in pavucontrol.
>
> > BTW, the lack of AMD SoC stuff might be related with the device power
> > state.  A cold boot might change the situation (or trying back to an
> > older known kernel).
> 
> I’ll try to boot again and see whether it breaks again.
> Currently I booted without the module option and it still works, but
> there was a kernel update.

That might explain.  There were a few fixes about HDMI HD-audio stuff
recently.


thanks,

Takashi
