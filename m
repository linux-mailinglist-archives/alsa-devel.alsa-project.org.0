Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 543593F1CED
	for <lists+alsa-devel@lfdr.de>; Thu, 19 Aug 2021 17:36:46 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id CD73A168B;
	Thu, 19 Aug 2021 17:35:55 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz CD73A168B
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1629387405;
	bh=PX/M5GwFL/ps4yxXkiOy3pWn8IHpoCeZWJnJdlZyTgk=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=adDkOoHrSGoayYUOCD5UzNd+Z0CSvIzh0YH/zzDoktijG6ra5+AGOiqxunZh4IFby
	 7zJcv7cCKLW4kA/dnjjXkF0uHF+b1OnGbnIWrEtpfdQQcZaz9L4BOMNEgVrakpKCuJ
	 e4cENbJuJnSGGnjfOAO3WDES7+4jDpP/Sc2P/yjs=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 3F196F800EC;
	Thu, 19 Aug 2021 17:35:28 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 71D07F8026D; Thu, 19 Aug 2021 17:35:26 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=-0.1 required=5.0 tests=DKIM_SIGNED,DKIM_VALID,
 DKIM_VALID_AU,SPF_HELO_NONE,SPF_NONE,URIBL_BLOCKED autolearn=disabled
 version=3.4.0
Received: from smtp-out1.suse.de (smtp-out1.suse.de [195.135.220.28])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 66CB0F800F8
 for <alsa-devel@alsa-project.org>; Thu, 19 Aug 2021 17:35:19 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 66CB0F800F8
Authentication-Results: alsa1.perex.cz;
 dkim=pass (1024-bit key) header.d=suse.de header.i=@suse.de
 header.b="AniigXpg"; 
 dkim=permerror (0-bit key) header.d=suse.de header.i=@suse.de
 header.b="4J8p8qlX"
Received: from relay2.suse.de (relay2.suse.de [149.44.160.134])
 by smtp-out1.suse.de (Postfix) with ESMTP id 055E82208C;
 Thu, 19 Aug 2021 15:35:19 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.de; s=susede2_rsa;
 t=1629387319; h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 in-reply-to:in-reply-to:references:references;
 bh=GKBJPHYcwt1CMc6DGWEqZMJftxY+mVm4KKjuocTeq84=;
 b=AniigXpgcqMWQEZJFnkFBQvVZvDtaI3+Ej3jyB7zn39S2dk/G28vEZhla14HGn1K/nCNCU
 fZ7P6mnzLzmHO3tQ60IoVgyaADfKoLNm2+GnuIG2+m9YBBXV3Uu5CygAC25ZbUYadmOYaW
 hWIwFZQC1AzmvNLIYmn0EImTpb+x0Yc=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.de;
 s=susede2_ed25519; t=1629387319;
 h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 in-reply-to:in-reply-to:references:references;
 bh=GKBJPHYcwt1CMc6DGWEqZMJftxY+mVm4KKjuocTeq84=;
 b=4J8p8qlX9G8yW/gniQKy33P4a5AabVhz9NhfoqFOvEzlK5ZZIG7eJkUu+yWOCX+3ztLqv7
 6gZNbnySDIb9aECA==
Received: from alsa1.suse.de (alsa1.suse.de [10.160.4.42])
 by relay2.suse.de (Postfix) with ESMTP id F3A32A3B83;
 Thu, 19 Aug 2021 15:35:18 +0000 (UTC)
Date: Thu, 19 Aug 2021 17:35:18 +0200
Message-ID: <s5hwnoh8n2h.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Mark Brown <broonie@kernel.org>
Subject: Re: [PATCH] ASoC: intel: atom: Fix breakage for PCM buffer address
 setup
In-Reply-To: <20210819152945.8510-1-tiwai@suse.de>
References: <20210819152945.8510-1-tiwai@suse.de>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: Hans de Goede <hdegoede@redhat.com>, alsa-devel@alsa-project.org
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Thu, 19 Aug 2021 17:29:45 +0200,
Takashi Iwai wrote:
> 
> The commit 2e6b836312a4 ("ASoC: intel: atom: Fix reference to PCM
> buffer address") changed the reference of PCM buffer address to
> substream->runtime->dma_addr as the buffer address may change
> dynamically.  However, I forgot that the dma_addr field is still not
> set up for the CONTINUOUS buffer type (that this driver uses) yet in
> 5.14 and earlier kernels, and it resulted in garbage I/O.  The problem
> will be fixed in 5.15, but we need to address it quickly for now.
> 
> The fix is to deduce the address again from the DMA pointer with
> virt_to_phys(), but from the right one, substream->runtime->dma_area.
> 
> Fixes: 2e6b836312a4 ("ASoC: intel: atom: Fix reference to PCM buffer address")
> Reported-and-tested-by: Hans de Goede <hdegoede@redhat.com>
> Cc: <stable@vger.kernel.org>
> Link: https://lore.kernel.org/r/2048c6aa-2187-46bd-6772-36a4fb3c5aeb@redhat.com
> Signed-off-by: Takashi Iwai <tiwai@suse.de>
> ---

Mark, as it's close to the 5.14 final, exceptionally I'd like to merge
this into my tree directly now, so that it can be certainly included
in the next PR to Linus.
(Also because the commit will be reverted on for-next again, too.)

After the merge, feel free to pull my for-linus branch into yours.


thanks,

Takashi
