Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 3C0E72D2C03
	for <lists+alsa-devel@lfdr.de>; Tue,  8 Dec 2020 14:31:47 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id B0E4316AA;
	Tue,  8 Dec 2020 14:30:56 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz B0E4316AA
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1607434306;
	bh=SljcaB0SaYf6LSgvIaMbxc2bAgzxpwEak7IehWNs3mw=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=fmPVasoVv2L1IZrYgd4c5S0M3aV8yp+FSH6e5loUOx3RDzn2VCFjAZTXjuRu848ju
	 DT5nMRbPZcaEfRHGFpsywE/+1wx5TxV4XwEk3tjNL82PK+WA62myRYW3weXB47K0si
	 aSpFHdQbNnT5lL/qjlwaM6PojUav4bTNO0YX28GI=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id B97ADF80218;
	Tue,  8 Dec 2020 14:30:11 +0100 (CET)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 4988DF8019D; Tue,  8 Dec 2020 14:30:09 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_NONE
 autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id C6ADFF800E1
 for <alsa-devel@alsa-project.org>; Tue,  8 Dec 2020 14:30:03 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz C6ADFF800E1
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id BA343AC9A;
 Tue,  8 Dec 2020 13:30:02 +0000 (UTC)
Date: Tue, 08 Dec 2020 14:30:02 +0100
Message-ID: <s5hv9dcwhlx.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Ben Bell <bjb-alsa-devel@deus.net>
Subject: Re: Behringer WING usb audio - cyclic xruns dependent on
 periods/buffers
In-Reply-To: <20201205144406.854292C16C@relay2.suse.de>
References: <20201126180612.E3E0CF80166@alsa1.perex.cz>
 <s5hblfjjguc.wl-tiwai@suse.de>
 <20201128093612.48C0CF80166@alsa1.perex.cz>
 <20201203200633.CC66A2C16F@relay2.suse.de>
 <s5hblfa575t.wl-tiwai@suse.de>
 <20201205144406.854292C16C@relay2.suse.de>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: alsa-devel@alsa-project.org
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Sat, 05 Dec 2020 15:43:56 +0100,
Ben Bell wrote:
> 
> > > Like I said in the initial email, it feels like some sort of clock drift
> > > problem, where we're managing very slowly to collect more samples than
> > > we're reading -- to the tune of about 1 extra every few cycles -- and
> > > nothing on the consumer side is ever managing to compensate for that.
> > > I'm not even sure how that sort of drift would be possible though. Seems
> > > surprising.
> [...]
> 
> > At least you can try the latest patch set destined for 5.11, which
> > should improve the cases for the implicit feedback.
> 
> Aha! This actually was the key piece of information I needed. I haven't
> tried 5.11 or the latest patch set yet, but googling "implicit feedback"
> and learning abobut it led me to conclude that the Wing needs an entry in
> the quirks list in set_sync_ep_implicit_fb_quirk to properly enable it:
> 
> --- sound/usb/pcm.c.orig        2020-11-22 23:36:08.000000000 +0000
> +++ sound/usb/pcm.c     2020-12-05 08:40:21.639600074 +0000
> @@ -340,6 +345,7 @@
>                 ep = 0x81;
>                 ifnum = 3;
>                 goto add_sync_ep_from_ifnum;
> +       case USB_ID(0x1397, 0x050b): /* Behringer Wing */
>         case USB_ID(0x0763, 0x2080): /* M-Audio FastTrack Ultra */
>         case USB_ID(0x0763, 0x2081):
> 
> 
> A week's worth of debugging and learning yielded a one line patch ;)

That's a interesting piece of information :)

Could you give lsusb -v output of the device?  With the latest patch
set, the driver can set up the implicit feedback mode automatically in
certain cases.  I'm not sure whether Behringer device follows that
pattern.  If not, we'd need to add the quirk manually.


thanks,

Takashi
