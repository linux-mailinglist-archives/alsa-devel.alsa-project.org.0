Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id EE7C5209A38
	for <lists+alsa-devel@lfdr.de>; Thu, 25 Jun 2020 09:05:08 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 7F41E18C4;
	Thu, 25 Jun 2020 09:04:18 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 7F41E18C4
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1593068708;
	bh=dvxi63yAMDTYcmLcd6I35VOezS8AXurQc8ZKmuyRWb4=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=oX1K1dPB9BNBlqrkWqPrYUbQUegcnKoyQJYODLY67/1iei+SGjHRymSkWBYzTgXt0
	 6uesboY+mvXF9lQrFv0GTFRf3od8rj236+6nckWFKrKgrUHXgGFP4yhsXjhMP54IR9
	 GKl1hd9Qm9KfChY1hJjl60bfMGNqXp6FrjxPZjgM=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 68C70F80218;
	Thu, 25 Jun 2020 09:03:27 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 23055F800B2; Thu, 25 Jun 2020 09:03:24 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=RCVD_IN_MSPIKE_H3,
 RCVD_IN_MSPIKE_WL,SPF_HELO_NONE,SPF_PASS autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id AD7FDF800B2
 for <alsa-devel@alsa-project.org>; Thu, 25 Jun 2020 09:03:19 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz AD7FDF800B2
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id BB56FAAD0;
 Thu, 25 Jun 2020 07:03:17 +0000 (UTC)
Date: Thu, 25 Jun 2020 09:03:17 +0200
Message-ID: <s5h7dvviq4q.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: "Arun Raghavan" <arun@arunraghavan.net>
Subject: Re: [PATCH] ALSA: hda/hdmi: Add Intel silent stream support
In-Reply-To: <3bfd1d2f-a2f0-4321-8f9d-2b9f265dcebd@www.fastmail.com>
References: <1592954796-12449-1-git-send-email-harshapriya.n@intel.com>
 <s5hr1u4lxee.wl-tiwai@suse.de>
 <f2da25c0-c740-4d44-ab66-6017622f7dde@perex.cz>
 <7dd38f98-e74a-94c0-6888-523e6189c00b@linux.intel.com>
 <s5ho8p8ifcn.wl-tiwai@suse.de>
 <2404f45d-832d-69a0-fb3b-1981ae455f50@linux.intel.com>
 <s5hftakid2e.wl-tiwai@suse.de>
 <3bfd1d2f-a2f0-4321-8f9d-2b9f265dcebd@www.fastmail.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Cc: alsa-devel@alsa-project.org,
 PulseAudio Discussion <pulseaudio-discuss@lists.freedesktop.org>,
 Harsha Priya <harshapriya.n@intel.com>,
 Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>,
 kai.vehmanen@intel.com, Emmanuel Jillela <emmanuel.jillela@intel.com>
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Thu, 25 Jun 2020 02:18:58 +0200,
Arun Raghavan wrote:
> 
> +pulseaudio-discuss for information
> 
> On Wed, 24 Jun 2020, at 1:33 PM, Takashi Iwai wrote:
> > On Wed, 24 Jun 2020 19:05:14 +0200,
> > Pierre-Louis Bossart wrote:
> > > 
> > > 
> > > 
> > > On 6/24/20 11:43 AM, Takashi Iwai wrote:
> > > > On Wed, 24 Jun 2020 17:33:45 +0200,
> > > > Pierre-Louis Bossart wrote:
> > > >>
> > > >>
> > > >>>>> The silent stream is enabled with a Kconfig option, as well as a kernel
> > > >>>>> parameter should there be a need to override the build time default.
> > > >>>>
> > > >>>> I'm not sure whether the module option is the best interface.
> > > >>>> An alternative is a mixer element that controls dynamically.Â  Then
> > > >>>> it'll be per card unlike the module option.
> > > >>>
> > > >>> +1, kcontrol seems the appropriate way to control this.
> > > >>
> > > >> It was my suggestion to use Kconfig+kernel parameter for
> > > >> simplicity/overrides.
> > > >>
> > > >> The kcontrol is a nice idea, but in practice we typically only have
> > > >> one card dealing with HDMI.
> > > >
> > > > Not really.  There are systems with two HDMI outputs from both
> > > > integrated and discrete GPUs.  Most modern systems are only with
> > > > hybrid graphics, though.
> > > 
> > > Ok, maybe I am mistaken, in most of the HDMI issues we've seen only
> > > one HDMI source.
> > > 
> > > But it's a good point that this is only supposed to be used for Intel
> > > whether it's a kernel parameter or a kcontrol shouldn't this be
> > > dependent on a PCI ID being detected and a SKYLAKE flag being set?
> > > it's my understanding that this applies from Skylake to TigerLake, not
> > > before.
> > 
> > I guess we can check it from the codec ID?  Change the probe function
> > for Skylake+ codecs to patch_i915_skl_hdmi and co, and set the flag
> > there.
> > 
> > > >> It also doesn't have a UCM representation
> > > >> so would force the use of amixer and manual configs, or the UCM file
> > > >> would always set the mode.
> > > >
> > > > But people usually use the distro kernels, so the situation is more or
> > > > less equivalent; you'd have to adjust a module option manually if you
> > > > want a different one from the default, and you'd have to be root to
> > > > change it.
> > > >
> > > > So, rather the question is how we should provide the setup of such
> > > > parameter.  It's supposed to be a part of power management stuff that
> > > > should be touched by either a smart PM tool or a manual override such
> > > > as runtime PM setup?  Or can it be seen as a more casual tuning?
> > > 
> > > I am not aware of such tools. The only thing I know is that some of
> > > the HDaudio power settings are already controlled by kernel
> > > parameters, e.g.
> > > 
> > > /etc/modprobe.d/audio_powersave.conf
> > > options snd_hda_intel power_save=1
> > 
> > Yes, it's been the primary knob for years to turn on/off the runtime
> > PM for HD-audio and other legacy drivers.  This was used by powertop
> > or some other power-aware daemons and tools, to be toggled dynamically
> > per the power cable state or such.
> > 
> > And, how the silent stream feature should be seen?
> > Should it be a system-wide root-only setup or adjustable per user?
> > Would it be changed often?  Such questions and answers will lead us to
> > the right direction, I hope.
> 
> For audio, would UCM not be the appropriate point for a system integrator to decide how the audio device should be set up?
> 
> This would allow for a choice based on the situation in which the device is actually being deployed without users having to muck around with module parameters -- maybe someone wants want this enabled for an HTPC setup, but not on a desktop connected to a monitor.

Right, that's my concern.  Many users with HDMI monitor that is
capable of audio don't use HDMI audio because they don't need it
and/or the output sucks.  For them, this feature is superfluous and
harmful from the runtime PM POV.

If it were provided via UCM, would it be yet another UCM profile like
HDMI+silentstream?  This can be confusing, too, I'm afraid.

 From the interface POV, as Kai suggested in another mail, the
analogy to power_save option makes sense.  OTOH, power_save is the
knob that is better to be enabled (as long as it works), silent stream
is the feature that is needed only when required.  So it comes to the
question which interface is easier to manage.


thanks,

Takashi
