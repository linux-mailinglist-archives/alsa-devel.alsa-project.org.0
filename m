Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 85B6F2D44A2
	for <lists+alsa-devel@lfdr.de>; Wed,  9 Dec 2020 15:46:35 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 16759169C;
	Wed,  9 Dec 2020 15:45:45 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 16759169C
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1607525195;
	bh=04u/YWHn79CwwHTnuuabHMY68OpC47CyPn8F6seKZHs=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=tJI2TEJ4ym98y6dObJdN0X5fBBhAu3rSkuXAOGaLuax8WSMUsoWJWzH5U6GoEoOKL
	 RsGzy9qstESSaXAQyBusqphlhz3BPewA3rqGgwwV6eYR/yNmEpHhcDjG9n8QcMabG5
	 0SBGkT/EpUVdZtjV2EKieAaiYuaxCANZVWsevxDE=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 36CCBF80217;
	Wed,  9 Dec 2020 15:45:00 +0100 (CET)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 0BADCF8020D; Wed,  9 Dec 2020 15:44:58 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_NONE
 autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 8F73CF800EF
 for <alsa-devel@alsa-project.org>; Wed,  9 Dec 2020 15:44:52 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 8F73CF800EF
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id 67883ACF4;
 Wed,  9 Dec 2020 14:44:51 +0000 (UTC)
Date: Wed, 09 Dec 2020 15:44:51 +0100
Message-ID: <s5hy2i7rqcc.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Jaroslav Kysela <perex@perex.cz>
Subject: Re: [RFC][PATCH 0/2] design a way to change audio Jack state by
 software
In-Reply-To: <575811fc-cb64-c7d4-bf6b-5044949a326c@perex.cz>
References: <20201209124344.219158-1-hui.wang@canonical.com>
 <575811fc-cb64-c7d4-bf6b-5044949a326c@perex.cz>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: Hui Wang <hui.wang@canonical.com>, alsa-devel@alsa-project.org
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Wed, 09 Dec 2020 15:25:42 +0100,
Jaroslav Kysela wrote:
> 
> Dne 09. 12. 20 v 13:43 Hui Wang napsal(a):
> > After we change sth in the userspace audio stack like alsa-ucm or
> > pulseaudio, we want to perform remote audio auto test to verify if the
> > change introduce the regression or not, some of the tests are about
> > the defaut_sink/default_source or active_port switching, this needs
> > the audio jack state to be changed to trigger the userspace's audio
> > device switching.
> > 
> > So far, there is no software ways to change the audio jack state, this
> > block the auto test.
> 
> I'm not convinced to pollute the kernel space with this code. You can use
> LD_PRELOAD and simulate this via a shared library or the alsa-lib may be extended.

While I understand this argument, I see the merit of having the
kernel-side injection, too.  Wrapping with LD_PRELOAD (or use alsa-lib
plugin) doesn't verify whether the whole jack system works.  OTOH, the
jack injection in kernel simulates the closer path to the real use
case, which covers also the call paths inside the kernel.

Though, I'm not sure whether the current design is the best choice.
Basically sysfs is expressed in one value per file (although there are
many exceptions, of course).  So creating a node per jack object might
fit better?  Or can it better be in debugfs?

> Also, the first patch can be omitted if you just create another
> snd_jack_report() function for the user API and put the common code to the
> static function in jack.c.

Fully agreed on this point.


thanks,

Takashi
