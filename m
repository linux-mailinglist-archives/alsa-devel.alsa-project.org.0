Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id F06AF1819D
	for <lists+alsa-devel@lfdr.de>; Wed,  8 May 2019 23:22:40 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 6E6181AB2;
	Wed,  8 May 2019 23:21:50 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 6E6181AB2
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1557350560;
	bh=in+hqX3dKasAzAnpKjP6aVNzkJyCv4pZkOlgcn/jh9s=;
	h=Date:From:To:In-Reply-To:References:Cc:Subject:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=RWt9+bXIPDjvXJPOx27Qp/gOfveRV+QgTTC5MOCwi/dKZgjTCwGLT8Gmv82yV0nVM
	 TQmVZKJbcWAc4hlUyBUd9VwB4whgcZUw6c1a0OcO9agEwcogN+M8M3fxzFh5j7k2mH
	 lICvtYxiSCpnBujE2rjN4gXydTndeMlOy73o8R+Y=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 2E748F807B5;
	Wed,  8 May 2019 23:20:56 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 756ADF896F0; Wed,  8 May 2019 23:20:53 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: *
X-Spam-Status: No, score=1.0 required=5.0 tests=PRX_BODY_30,SPF_PASS,
 URIBL_BLOCKED autolearn=disabled version=3.4.0
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 6598FF807B5
 for <alsa-devel@alsa-project.org>; Wed,  8 May 2019 23:20:49 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 6598FF807B5
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 1A904AD96;
 Wed,  8 May 2019 21:20:49 +0000 (UTC)
Date: Wed, 08 May 2019 23:20:48 +0200
Message-ID: <s5htve4mymn.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Ranjani Sridharan <ranjani.sridharan@linux.intel.com>
In-Reply-To: <aa0c6eea81a721f340dd1362801e49049a6620dd.camel@linux.intel.com>
References: <1557282761-26146-1-git-send-email-libin.yang@intel.com>
 <aa0c6eea81a721f340dd1362801e49049a6620dd.camel@linux.intel.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Cc: libin.yang@intel.com, alsa-devel@alsa-project.org,
 ranjani.sridharan@intel.com, pierre-louis.bossart@linux.intel.com,
 rander.wang@intel.com, broonie@kernel.org
Subject: Re: [alsa-devel] [PATCH V2] ASoC: soc-pcm: BE dai needs prepare
	when pause release after resume
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Wed, 08 May 2019 18:30:08 +0200,
Ranjani Sridharan wrote:
> 
> On Wed, 2019-05-08 at 10:32 +0800, libin.yang@intel.com wrote:
> > From: Libin Yang <libin.yang@intel.com>
> > 
> > If playback/capture is paused and system enters S3, after system
> > returns
> > from suspend, BE dai needs to call prepare() callback when
> > playback/capture
> > is released from pause if RESUME_INFO flag is not set.
> Hi Takashi,
> 
> This is a question for you. We've run into the problem of not being
> able to do a pause-release after the system resumes from S3 after we
> removed INFO_RESUME from the SOF driver. 
> 
> Apparently, with this flag removed, when the user does a pause release
> after resuming from S3, the prepare() callback gets invoked for the FE
> but doesnt happen for the the BE. Could you please guide us on whether
> this is the right approach and if not, suggest an alternative?

Hm, it's a good question.  Currently the PCM core doesn't care about
the paused stream wrt PM by the assumption that the paused / stopped
stream doesn't need a special resume treatment.  But, generally
speaking, the pause-release won't work for a hardware that doesn't
support the full resume, either.  For example, the legacy HD-audio may
restart from some wrong position if resumed from the pause.

Maybe this problem hasn't been seen just because the pause function is
rarely used.

So, the safe behavior would be to let the stream being SUSPENDED state
at snd_pcm_stream_suspend() when it's in the PAUSED and has no
INFO_RESUME capability.  Then the application does re-prepare the
stream like the running one.

But the question is what's expected at next.  Should the application
re-start?  But it was paused.  Should PCM core automatically move to
pause?  But most hardware can't move the pointer to any random
position.

My gut feeling is just to treat like a normal error-restart,
i.e. re-prepare / re-start.  But I'm open and would like to hear more
opinions.


thanks,

Takashi



_______________________________________________
Alsa-devel mailing list
Alsa-devel@alsa-project.org
https://mailman.alsa-project.org/mailman/listinfo/alsa-devel
