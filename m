Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 1F85F43258D
	for <lists+alsa-devel@lfdr.de>; Mon, 18 Oct 2021 19:52:15 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 93E7A175B;
	Mon, 18 Oct 2021 19:51:24 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 93E7A175B
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1634579534;
	bh=siIhHn8FTveaySCwdIR4Q8qSVWOkLRL8k7ocU/vc2h0=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=tVDZoBLpih+N6UPgHEOaimfk4uOweoAMpnYaM/V208xnKaIdYQ/7Ig/7CfCZyIpyK
	 qS7JEaHn6kMwssg6QViQx4PbIQTRX/T5ZI/MW7ybAWClFqJdEynhVH48lMLg6bs4UB
	 IJkJ5lCrd3eiYgbzZUcUb//hlqdF/NPYIacPAUa4=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id E2DA7F80253;
	Mon, 18 Oct 2021 19:50:57 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id B5895F80224; Mon, 18 Oct 2021 19:50:54 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=-0.1 required=5.0 tests=DKIM_SIGNED,DKIM_VALID,
 DKIM_VALID_AU,SPF_HELO_NONE,SPF_NONE autolearn=disabled version=3.4.0
Received: from smtp-out1.suse.de (smtp-out1.suse.de [195.135.220.28])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 0E030F80111
 for <alsa-devel@alsa-project.org>; Mon, 18 Oct 2021 19:50:45 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 0E030F80111
Authentication-Results: alsa1.perex.cz;
 dkim=pass (1024-bit key) header.d=suse.de header.i=@suse.de
 header.b="ccC9P/gA"; 
 dkim=permerror (0-bit key) header.d=suse.de header.i=@suse.de
 header.b="tFi2cmqP"
Received: from relay2.suse.de (relay2.suse.de [149.44.160.134])
 by smtp-out1.suse.de (Postfix) with ESMTP id 42E7D21964;
 Mon, 18 Oct 2021 17:50:44 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.de; s=susede2_rsa;
 t=1634579444; h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 in-reply-to:in-reply-to:references:references;
 bh=2E/jinIm3Qz+0EHSn9g9/nS8AdQbqRqJMIGUTyJPN14=;
 b=ccC9P/gAB2xA6nVeLs5bBnJZDeo80ryqdwjhGanIhn6XdjeDTbPBzhUbxuJSHjbVPbqJpY
 vszKfGQc6SZ5corIba72djx47ZCvPpe+Bk87E8v64KWtG6OQ+aq7TSjldkZS1JJYhUCegN
 /kK9UHPAv9q1EY7SrD0KZJ0vXv79oUU=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.de;
 s=susede2_ed25519; t=1634579444;
 h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 in-reply-to:in-reply-to:references:references;
 bh=2E/jinIm3Qz+0EHSn9g9/nS8AdQbqRqJMIGUTyJPN14=;
 b=tFi2cmqPTIPx0rxXReuC+aPYxWHti/zyQXRBxemHoslgFw+OZ/LAyWvcgJ6p3VWVGDpJ5o
 fgClFzYgnT8zJJCw==
Received: from alsa1.suse.de (alsa1.suse.de [10.160.4.42])
 by relay2.suse.de (Postfix) with ESMTP id 318FFA3B84;
 Mon, 18 Oct 2021 17:50:44 +0000 (UTC)
Date: Mon, 18 Oct 2021 19:50:44 +0200
Message-ID: <s5hee8i43yj.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Subject: Re: [PATCH v3 4/4] ASoC: SOF: Intel: add .ack support for HDaudio
 platforms
In-Reply-To: <ef4981bf-b935-77f1-00cb-9ac31a3e1fdd@linux.intel.com>
References: <20211015195932.224925-1-pierre-louis.bossart@linux.intel.com>
 <20211015195932.224925-5-pierre-louis.bossart@linux.intel.com>
 <s5hzgr85c6v.wl-tiwai@suse.de>
 <97cd3a79-bf2a-bb1a-7da1-89bc8bac2c13@linux.intel.com>
 <s5hilxu4898.wl-tiwai@suse.de>
 <ef4981bf-b935-77f1-00cb-9ac31a3e1fdd@linux.intel.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: alsa-devel@alsa-project.org, broonie@kernel.org,
 P9ter Ujfalusi <peter.ujfalusi@linux.intel.com>,
 Ranjani Sridharan <ranjani.sridharan@linux.intel.com>,
 Kai Vehmanen <kai.vehmanen@linux.intel.com>
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Mon, 18 Oct 2021 18:57:12 +0200,
Pierre-Louis Bossart wrote:
> 
> 
> 
> 
> > I mean only about the use EXPLICIT_SYNC flag.  There has been already
> > an info flag SYNC_APPLPTR, and this should suffice for your purpose.
> > In a nutshell:
> > 
> > EXPLICIT_SYNC = disable both control and status mmaps
> > SYNC_APPLPTR = disable only control mmap
> 
> Humm, are you sure Takashi? it's been a long time since we discussed
> this and your initial direction was to disable both?
> 
> To quote your own words from
> https://lore.kernel.org/alsa-devel/s5hfug51g0x.wl-tiwai@suse.de/
> 
> "In mmap mode, we transfer data on the mmap
> buffer, and update appl_ptr via mmap control.  Both are done without
> notification to the driver (which is intentional for avoiding the
> context switching).
> 
> So we want to disable this optimization and always notify to the
> driver.  Disabling mmap status/control is the straight hack as it
> falls back to ioctl and then the driver can know the change."

The above text was correct, per se.  There was no *_SYNC_APPLPTR flag
at that time, hence the only option was to disable both mmaps (that
was done for 32bit PCM compat streams).

But now we have two ways to disable, as mentioned in the previous
mail, that allows selectively disabling only the control mmap, which
is required in most cases.

> I really don't mind changing, I don't have enough background on this,
> just wanted to make sure that disabling the control mmap is sufficient
> on paper before we re-run tests. Thanks!

Yes, please verify.


thanks,

Takashi
