Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 2BA661786D7
	for <lists+alsa-devel@lfdr.de>; Wed,  4 Mar 2020 01:13:47 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 389AD1660;
	Wed,  4 Mar 2020 01:12:56 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 389AD1660
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1583280826;
	bh=XOWEF2X+fzZMR0junfJM6aQzd5XdbH6IYOcIlv9byYY=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=PziVAbmM/zJXtXcXsZSrpHyAVZq30x7ZM54SgTXonUJe8XAq7QIrrr9n8I1wxOQRQ
	 etO356WL9mMQlG8m8t190oCEstM+MWIPQM8h9GwAV9/m9wUz7bazWC0v7m7hn7SMVm
	 8P3TdpCqtjOk31P9eACJZ+N2zRMcS9aK3N3vVemQ=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 30BA2F8011C;
	Wed,  4 Mar 2020 01:12:05 +0100 (CET)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 7DF5AF8025F; Wed,  4 Mar 2020 01:12:01 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_PASS
 autolearn=disabled version=3.4.0
Received: from relmlie6.idc.renesas.com (relmlor2.renesas.com
 [210.160.252.172])
 by alsa1.perex.cz (Postfix) with ESMTP id 49C23F80131
 for <alsa-devel@alsa-project.org>; Wed,  4 Mar 2020 01:11:55 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 49C23F80131
Date: 04 Mar 2020 09:11:48 +0900
X-IronPort-AV: E=Sophos;i="5.70,511,1574089200"; d="scan'208";a="40671271"
Received: from unknown (HELO relmlir6.idc.renesas.com) ([10.200.68.152])
 by relmlie6.idc.renesas.com with ESMTP; 04 Mar 2020 09:11:48 +0900
Received: from mercury.renesas.com (unknown [10.166.252.133])
 by relmlir6.idc.renesas.com (Postfix) with ESMTP id D7A61411A34D;
 Wed,  4 Mar 2020 09:11:48 +0900 (JST)
Message-ID: <87ftep0yij.wl-kuninori.morimoto.gx@renesas.com>
From: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
To: Kai Vehmanen <kai.vehmanen@linux.intel.com>
Subject: Re: [PATCH] ASoC: soc-pcm: Revert "call
 snd_soc_component_open/close() once"
In-Reply-To: <alpine.DEB.2.21.2003032107560.2957@eliteleevi.tm.intel.com>
References: <20200219182650.1416-1-kai.vehmanen@linux.intel.com>
 <87blput7hh.wl-kuninori.morimoto.gx@renesas.com>
 <alpine.DEB.2.21.2002201103060.2957@eliteleevi.tm.intel.com>
 <87mu9cspyf.wl-kuninori.morimoto.gx@renesas.com>
 <alpine.DEB.2.21.2002211251280.2957@eliteleevi.tm.intel.com>
 <87mu978pob.wl-kuninori.morimoto.gx@renesas.com>
 <87ftey88wk.wl-kuninori.morimoto.gx@renesas.com>
 <alpine.DEB.2.21.2002271110010.2957@eliteleevi.tm.intel.com>
 <874kvb7d38.wl-kuninori.morimoto.gx@renesas.com>
 <871rqf6xas.wl-kuninori.morimoto.gx@renesas.com>
 <87zhd35eko.wl-kuninori.morimoto.gx@renesas.com>
 <alpine.DEB.2.21.2002281404580.2957@eliteleevi.tm.intel.com>
 <87d09vha51.wl-kuninori.morimoto.gx@renesas.com>
 <alpine.DEB.2.21.2003021902500.2957@eliteleevi.tm.intel.com>
 <8736aq2rp2.wl-kuninori.morimoto.gx@renesas.com>
 <alpine.DEB.2.21.2003032107560.2957@eliteleevi.tm.intel.com>
User-Agent: Wanderlust/2.15.9 Emacs/25.2 Mule/6.0
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Cc: alsa-devel@alsa-project.org, broonie@kernel.org,
 ranjani.sridharan@linux.intel.com, digetx@gmail.com,
 pierre-louis.bossart@linux.intel.com
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>


Hi Kai

Thank you for your feedback

> > close() will be called 1) when open failed, or, 2) normal close.
> > If my understanding was correct, your code is caring that
> > 2) normal close() might be called without open().
> 
> it also covers case (1) when open fails. So instead of the currently 
> merged error case rollback code in soc_pcm_components_open(), we'd just 
> call snd_pcm_components_close(substream) directly in case 
> of error. With tracking of opened substreams in soc-component.c, close() 
> is safe to call also in error case.

Oh, yes, of course.
I'm sorry to you for my lack of words.
My question was
"My idea cares open-close mismatch only for 1).
and your's cared both 1) and 2) ?", I mean.

> That considered, I'm fine if you can come up with a cleaner version to 
> handle just case (1), without tracking substreams. Maybe worth a try and 
> if it doesn't work (e.g. with ID/tag), we can look at substream tracking.

I see.
Let's use step-by-step approach.
I will try to care 1) as 1st step.
If it was not enough, or, if we want to have tracker,
let's update it by your idea as 2nd step.

Thank you for your help !!

Best regards
---
Kuninori Morimoto
