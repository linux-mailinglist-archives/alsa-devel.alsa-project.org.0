Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 7C6B81BA5B0
	for <lists+alsa-devel@lfdr.de>; Mon, 27 Apr 2020 16:07:30 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 0EB43168C;
	Mon, 27 Apr 2020 16:06:40 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 0EB43168C
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1587996450;
	bh=xocaWQi737FNUDH/M7o8zL3tThKIFWhQdU4IYcFxvnI=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=MF+3a7vUy6VNx1vdwVy0CIcbrij+vZyl/OFdnhuN6+mCp85vAzlhceglojlZri3op
	 BV3mAJSZ1yTxDrjKHPCaCsv/1viDhYuhO/+RgTNb1psZvBaPdvZ31KWGGZS/z3o7d8
	 hnnZM5tj9Zou/ITuAZT0RicCJnfsrJUskHZ5cRhU=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 2A2F8F80112;
	Mon, 27 Apr 2020 16:05:49 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id BC1E4F8022B; Mon, 27 Apr 2020 16:05:45 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=-0.0 required=5.0 tests=RCVD_IN_MSPIKE_H3,
 RCVD_IN_MSPIKE_WL,SPF_HELO_NONE,SPF_PASS,URIBL_BLOCKED autolearn=disabled
 version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 05C7EF80113
 for <alsa-devel@alsa-project.org>; Mon, 27 Apr 2020 16:05:39 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 05C7EF80113
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id DA3D2AB91;
 Mon, 27 Apr 2020 14:05:37 +0000 (UTC)
Date: Mon, 27 Apr 2020 16:05:37 +0200
Message-ID: <s5hv9llnhvy.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Pavel Hofman <pavel.hofman@ivitera.com>
Subject: Re: High-bandwidth/multiple transactions per microframe in usb audio?
In-Reply-To: <dbaba3f0-88b8-21f2-b7dc-5e1c5fadc675@ivitera.com>
References: <ee53ad0d-2d61-545b-7afd-64a5ed37c702@ivitera.com>
 <548c8312bd8ad65993c3169faf30054fdfa83558.camel@tsoy.me>
 <3a44ca23-f0ed-af54-3e63-8bf77d833c8f@ivitera.com>
 <253259a4ef8a2bcfa0568982b8fd23d5e2d0937a.camel@tsoy.me>
 <dbaba3f0-88b8-21f2-b7dc-5e1c5fadc675@ivitera.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Cc: Alexander Tsoy <alexander@tsoy.me>,
 "alsa-devel@alsa-project.org" <alsa-devel@alsa-project.org>
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Sun, 26 Apr 2020 10:55:32 +0200,
Pavel Hofman wrote:
> 
> Dne 25. 04. 20 v 21:50 Alexander Tsoy napsal(a):
> > В Сб, 25/04/2020 в 20:06 +0200, Pavel Hofman пишет:
> > 
> > And I just noticed that USB-audio driver can't properly parse max
> > packet size for SuperSpeed and SuperSpeed+ devices yet. See
> > audio_format_alloc_init().
> 
> Very good catch. IIUC there are two basically equivalent calculations
> for HighSpeed -
> 
> https://elixir.bootlin.com/linux/v5.6.7/source/drivers/usb/core/urb.c#L445
> 
> 
> https://elixir.bootlin.com/linux/v5.6.7/source/sound/usb/stream.c#L691
> 
> 
> And audio_format_alloc_init missing the sections for SS, SS+ in
> usb_submit_urb . Perhpas a common method to make the calculation for all
> cases would make it more robust?

Yes, a common USB helper function sounds like a good idea.


thanks,

Takashi
