Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id AAF4A1E0B27
	for <lists+alsa-devel@lfdr.de>; Mon, 25 May 2020 11:58:40 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 3AC50172E;
	Mon, 25 May 2020 11:57:50 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 3AC50172E
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1590400720;
	bh=yLPLZrAcJ/A7ZiuDRxWbfdjidAFJ1ALqEg4E3Uus/zY=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=nmHOWp3BdR4Jo/2PTxrx0eNz/BEgMiE/Ale7x3Z4eFys9CjLHBgKwvIy9cLVUKvp7
	 hQBNChst0+r1VKGvkmaXXbNPqS/FFs0IXbASRGeZNiU80ejvf4QmeTz41l1u6bOLjb
	 SBPPWuxsLMDApQ2DRRcecJghEBGLc7xaugKIE9dI=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 6998CF8021E;
	Mon, 25 May 2020 11:56:59 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id AE055F8016F; Mon, 25 May 2020 11:56:57 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=-0.0 required=5.0 tests=RCVD_IN_MSPIKE_H3,
 RCVD_IN_MSPIKE_WL,SPF_HELO_NONE,SPF_PASS autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 5D8D8F8014A
 for <alsa-devel@alsa-project.org>; Mon, 25 May 2020 11:56:53 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 5D8D8F8014A
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id 677A2AD72;
 Mon, 25 May 2020 09:56:54 +0000 (UTC)
Date: Mon, 25 May 2020 11:56:51 +0200
Message-ID: <s5hk110uyl8.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Changming Liu <liu.changm@northeastern.edu>
Subject: Re: [Bug Report]Sound: sound/core/hwdep.c undefined result by left
 shifting 1 by 31 
In-Reply-To: <BL0PR06MB4548066F35C44C55459B3F60E5B70@BL0PR06MB4548.namprd06.prod.outlook.com>
References: <BL0PR06MB4548066F35C44C55459B3F60E5B70@BL0PR06MB4548.namprd06.prod.outlook.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: "alsa-devel@alsa-project.org" <alsa-devel@alsa-project.org>, "Lu,
 Long" <l.lu@northeastern.edu>, "tiwai@suse.com" <tiwai@suse.com>,
 "yaohway@gmail.com" <yaohway@gmail.com>
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Fri, 22 May 2020 01:32:00 +0200,
Changming Liu wrote:
> 
> Hi Jaroslav, Takashi:
> Greetings, I'm a first year PhD student who is interested in using UBSan for linux. 
> After some experiments, I found that in sound/core/hwdep.c function snd_hwdep_dsp_load 
> there might be an undefined behavior that might cause unexpected result.
> 
> More specifically, in this function,info was fetched from user space and,
> info.index was checked if it's greater than or equal to 32.
> If not then it's used as number of left shift bits to string literal 1.
> 
> The problem is, since string literal 1 is by default signed int, so 1 << 31 cannot be represented as a valid integer and
>  the result might be undefined across different platforms. So I guess change 1 to 1U might help?

Yes, that should work.

> Due to the lack of knowledge of the interaction between this module and others, I'm not able to assess if 
> this is critical or worth fixing. I'd appreciate if for your comment on this bug. This can help me understand UB a lot!

I don't think this is any serious problem.  It's a bit flag that just
indicates the status and the flag itself has any influence on the
behavior of the rest in kernel.  And, the hwdep DSP load feature
itself is used very rarely, only by a couple of drivers.  So it's
pretty much never hit.

That said, we can simply fix the issue at any time, and it's "just to
be sure".  Could you submit a fix patch in the proper format?


thanks,

Takashi
