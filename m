Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id EB8D731E79A
	for <lists+alsa-devel@lfdr.de>; Thu, 18 Feb 2021 09:46:15 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 8C6DF1655;
	Thu, 18 Feb 2021 09:45:25 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 8C6DF1655
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1613637975;
	bh=d8U22QgxwTteAjf0rSZbvrf5sWcCs36EGsMN28LgUvU=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=uxeyDCcbtNTxAFfe1yIRX/L6NUfn/veKJfJKFoJeokjsyjYdsgRLd3R/p8HL3Hr2K
	 ckjYFUcsKmVdWWekgn+IIePAEbtTpZyKhZA/PFmDw7XtAYUGXWrpac7+YEflwl7RmN
	 8i1e+2Z/6+J4Uh+0mzDPdK/El+XT2bS41Rm+7iD0=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id C958BF800E9;
	Thu, 18 Feb 2021 09:44:44 +0100 (CET)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id A939DF8015A; Thu, 18 Feb 2021 09:44:42 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_NONE,
 URIBL_BLOCKED autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id DC7E5F800D0
 for <alsa-devel@alsa-project.org>; Thu, 18 Feb 2021 09:44:31 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz DC7E5F800D0
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id 0FFD4AC6E;
 Thu, 18 Feb 2021 08:44:31 +0000 (UTC)
Date: Thu, 18 Feb 2021 09:44:30 +0100
Message-ID: <s5hr1ld22a9.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: =?UTF-8?B?IlNodW1pbmcgW+iMg+abuOmKmF0i?= <shumingf@realtek.com>
Subject: Re: [PATCH] ASoC: rt5682: remove jack detect delay
In-Reply-To: <5b90530b77744937b87bbbd35901e320@realtek.com>
References: <20210217214914.700751-1-cujomalainey@chromium.org>
 <5b90530b77744937b87bbbd35901e320@realtek.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Cc: Oder Chiou <oder_chiou@realtek.com>, Jack Yu <jack.yu@realtek.com>,
 "alsa-devel@alsa-project.org" <alsa-devel@alsa-project.org>,
 Takashi Iwai <tiwai@suse.com>, Liam Girdwood <lgirdwood@gmail.com>,
 Mark Brown <broonie@kernel.org>,
 =?UTF-8?B?IkRlcmVrIFvmlrnlvrfnvqldIg==?= <derek.fang@realtek.com>,
 Curtis Malainey <cujomalainey@chromium.org>,
 Bard liao <yung-chuan.liao@linux.intel.com>,
 "Flove\(HsinFu\)" <flove@realtek.com>
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Thu, 18 Feb 2021 09:38:53 +0100,
Shuming [范書銘] <shumingf@realtek.com> wrote:
> 
> > There is a 250ms delay on the jack detect interrupt currently, this delay is
> > observable to users who are using inline controls. It can also mask multiple
> > presses which is a negative experience.
> > 
> > Cc: Bard liao <yung-chuan.liao@linux.intel.com>
> > Cc: Shuming Fan <shumingf@realtek.com>
> > 
> > Signed-off-by: Curtis Malainey <cujomalainey@chromium.org>
> > ---
> >  sound/soc/codecs/rt5682-i2c.c | 2 +-
> >  1 file changed, 1 insertion(+), 1 deletion(-)
> > 
> > diff --git a/sound/soc/codecs/rt5682-i2c.c b/sound/soc/codecs/rt5682-i2c.c
> > index 93c1603b42f1..b15c3e7d1f59 100644
> > --- a/sound/soc/codecs/rt5682-i2c.c
> > +++ b/sound/soc/codecs/rt5682-i2c.c
> > @@ -78,7 +78,7 @@ static irqreturn_t rt5682_irq(int irq, void *data)
> >  	struct rt5682_priv *rt5682 = data;
> > 
> >  	mod_delayed_work(system_power_efficient_wq,
> > -		&rt5682->jack_detect_work, msecs_to_jiffies(250));
> > +		&rt5682->jack_detect_work, 0);
> 
> How about using the device property to adjust the delay time?
> I think it should keep the workqueue to do the jack/button detection because the jack type detection will take some times to do.

One might check twice (or more) if it's not certain, too.  That is,
check the jack immediately, and if the jack state really changed,
report it so.  OTOH, if the jack state doesn't change from the old
state, it can retry after some delay.


thanks,

Takashi
