Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id BCCDC38FB8E
	for <lists+alsa-devel@lfdr.de>; Tue, 25 May 2021 09:21:19 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 4DA741657;
	Tue, 25 May 2021 09:20:29 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 4DA741657
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1621927279;
	bh=ekyAgz2vMZEX83v35HQFaSwJcNoNFbxzbpAEdc8Hp3I=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=Iy5U/Gy740JoGgkYqWFOMdch0Yabuk7YSVRpfcFFktk0mtICSxKGshUGRD31ZMCi+
	 jY9k5bq7cJdMWgqJI2bhjG7+6cRf4bdtVf0W6AHpfWKz2PYCw5cGpCXGkJnOxhfeuv
	 hA17EYjN1WCqQfYnwRqO89nrk3ij2mY/HgDabstY=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id BC8AEF8011B;
	Tue, 25 May 2021 09:19:50 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 58FB4F801EB; Tue, 25 May 2021 09:19:48 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=-0.1 required=5.0 tests=DKIM_SIGNED,DKIM_VALID,
 DKIM_VALID_AU,RCVD_IN_MSPIKE_H3,RCVD_IN_MSPIKE_WL,SPF_HELO_NONE,SPF_PASS,
 URIBL_BLOCKED autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id BE8FAF80113
 for <alsa-devel@alsa-project.org>; Tue, 25 May 2021 09:19:39 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz BE8FAF80113
Authentication-Results: alsa1.perex.cz;
 dkim=pass (1024-bit key) header.d=suse.de header.i=@suse.de
 header.b="WJ0h1zdp"; 
 dkim=permerror (0-bit key) header.d=suse.de header.i=@suse.de
 header.b="b8vVnQ5D"
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.de; s=susede2_rsa;
 t=1621927179; h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=cVoKjAY3jH8rmYc8Rd7l7OYBErdAvn5UszLrouhHoUE=;
 b=WJ0h1zdp+hzFcGNFDt5Q7BayX2aKtZhzYT0WghSYW04pdmdj0HvSq9xxe0kBXAFdWFe2hE
 r6CdcVGTMwQnPutcDi2kV6VvDK7vr56/TFSmSiyxWUwpIMC/KDTTRpH5ZNHLfQb5P+Xhzp
 Enb9j902GPgcv5+ckDaq+vHRQrSFpg0=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.de;
 s=susede2_ed25519; t=1621927179;
 h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=cVoKjAY3jH8rmYc8Rd7l7OYBErdAvn5UszLrouhHoUE=;
 b=b8vVnQ5DJh5mEHubT3CYlSJfVHMp9AbEXJvilSyXqSixtad2pF5o10mMiq5BhxH4pdt1HA
 Moe04BCvo/Hu8ZDQ==
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id A65C1AEAB;
 Tue, 25 May 2021 07:19:39 +0000 (UTC)
Date: Tue, 25 May 2021 09:19:39 +0200
Message-ID: <s5hfsybe0vo.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Peter Ujfalusi <peter.ujfalusi@linux.intel.com>
Subject: Re: [PATCH] ALSA: hda: Add Lenovo ThinkStation P340 to
 power_save_denylist
In-Reply-To: <20210524152533.7479-1-peter.ujfalusi@linux.intel.com>
References: <20210524152533.7479-1-peter.ujfalusi@linux.intel.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Cc: alsa-devel@alsa-project.org, tiwai@suse.com, kai.vehmanen@linux.intel.com
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Mon, 24 May 2021 17:25:33 +0200,
Peter Ujfalusi wrote:
> 
> On playback start there is a huge plock/pop noise via the green jack used
> in Line out mode.
> 
> The only way I was able to fix it to set the power_save to 0 for the
> snd_hda_intel.
> 
> Signed-off-by: Peter Ujfalusi <peter.ujfalusi@linux.intel.com>
> ---
> Hi Takashi,
> 
> Changes since RFC:
> - Fixed up the PCI ID
> 
> ever since I have this workstation (three weeks) the plock/pop noise on playback
> start bugged me. So far the only solution I have found is to disable the
> power_save which I find acceptable on a desktop compared to the pops.
> 
> The alsa-info.sh output is can be found here:
> http://alsa-project.org/db/?f=414b1b236fc73db386ad4f938bc3b304f6b30b05
> 
> Missing details from alsa-info output:
> # lspci -nnk | grep -A2 Audio
> 00:1f.3 Audio device [0403]: Intel Corporation Comet Lake PCH cAVS [8086:06c8]
>         DeviceName: Onboard - Sound
>         Subsystem: Lenovo Device [17aa:1048]
> 
> CPU: i9-10900k
> 
> The machine have ALC623 codec and the jacks are correctly discovered and they
> do what they supposed to be.
> When I have the headset connected to the front and audio is routed there the
> line out (green jack) from the back still prodices the plock/pop.
> 
> Is there a known quirk for similar issue or a better way to handle it?

In general, this deny list is the last resort when we couldn't find
any other way to fix the click noise.  Let's check other possibilities
at first, e.g. setting auto_mute_via_amp flag.  This can be achieved
even via hints in an early patching specified via "patch" option of
snd-hda-intel module (see Documentation/sound/hda/notes.rst for some
information).


Takashi
