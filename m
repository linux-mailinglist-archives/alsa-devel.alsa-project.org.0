Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 59C402CBFCA
	for <lists+alsa-devel@lfdr.de>; Wed,  2 Dec 2020 15:33:27 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id E2E46178F;
	Wed,  2 Dec 2020 15:32:36 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz E2E46178F
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1606919607;
	bh=ouY3rctqd+qSZ8fSC5m8ks2FJ5bzPXaSpqzeKE5jCSE=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=sfo37qbrToeKl3iDTdqABwWTjkvglhXH0rhrtx0nppjrzs9MdmUIuZc30414kukGM
	 vezS+LRPeqWJ/VTWyWtqMBUemnZchLvK0fsgUQptP3lEO6k1gDY7XBJV4ZhoWvc6he
	 cnWJ5QjRl59OW9v6oS3c3k+E41PGlIvbRFJrrk0w=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 0EEC0F8049C;
	Wed,  2 Dec 2020 15:31:52 +0100 (CET)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id A5353F8026B; Wed,  2 Dec 2020 15:31:49 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=RCVD_IN_MSPIKE_H3,
 RCVD_IN_MSPIKE_WL,SPF_HELO_NONE,SPF_PASS,URIBL_BLOCKED autolearn=disabled
 version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id F39C4F80082
 for <alsa-devel@alsa-project.org>; Wed,  2 Dec 2020 15:31:41 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz F39C4F80082
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id 4833CAD5C;
 Wed,  2 Dec 2020 14:31:41 +0000 (UTC)
Date: Wed, 02 Dec 2020 15:31:41 +0100
Message-ID: <s5him9k8ek2.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Jonas Holmberg <jonashg@axis.com>
Subject: Re: [PATCH] pcm: set the snd_pcm_ioplug_status() tstamp field
In-Reply-To: <20201105142437.GA265496@axis.com>
References: <20201104134956.260519-1-jonashg@axis.com>
 <20201105142437.GA265496@axis.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: "alsa-devel@alsa-project.org" <alsa-devel@alsa-project.org>
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Thu, 05 Nov 2020 15:24:37 +0100,
Jonas Holmberg wrote:
> 
> On Wed, Nov 04, 2020 at 02:49:56PM +0100, Jonas Holmberg wrote:
> > Set the status tstamp field so that it can be accessed with
> > snd_pcm_status_get_htstamp().
> > 
> > Signed-off-by: Jonas Holmberg <jonashg@axis.com>
> > ---
> >  src/pcm/pcm_ioplug.c | 1 +
> >  1 file changed, 1 insertion(+)
> > 
> > diff --git a/src/pcm/pcm_ioplug.c b/src/pcm/pcm_ioplug.c
> > index a437ca32..9b1b8ac3 100644
> > --- a/src/pcm/pcm_ioplug.c
> > +++ b/src/pcm/pcm_ioplug.c
> > @@ -115,6 +115,7 @@ static int snd_pcm_ioplug_status(snd_pcm_t *pcm, snd_pcm_status_t * status)
> >  	snd_pcm_ioplug_hw_ptr_update(pcm);
> >  	status->state = io->data->state;
> >  	status->trigger_tstamp = io->trigger_tstamp;
> > +	gettimestamp(&status->tstamp, pcm->tstamp_type);
> >  	status->avail = snd_pcm_mmap_avail(pcm);
> >  	status->avail_max = io->avail_max;
> >  	return 0;
> > -- 
> > 2.26.2
> > 
> 
> Is there a reason that the tstamp field of snd_pcm_ioplug_status() is 
> always 0? I assumed that it was an oversight/bug so this patch sets it 
> so that applications can read it with snd_pcm_status_get_htstamp(). I 
> have tested it and it seems to work well.

I guess it's an oversight.  It's one of few places where the no real
hardware slave PCM is present, and the other one (null plugin) already
set it.

Also maybe cause snd_pcm_htimestamp() worked without this change; it's
updating the timstamp with a different code path.

In anyway, I applied your patch now.  Thanks!


Takashi
