Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 67C1C692F7A
	for <lists+alsa-devel@lfdr.de>; Sat, 11 Feb 2023 09:43:43 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher ADH-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 76DA4843;
	Sat, 11 Feb 2023 09:42:52 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 76DA4843
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1676105022;
	bh=5xtlvae2wJ4u/uRMO0YfhPbua/bvZ6fcnrfQNyE9PNk=;
	h=Date:From:To:Subject:In-Reply-To:References:CC:List-Id:
	 List-Archive:List-Help:List-Owner:List-Post:List-Subscribe:
	 List-Unsubscribe:From;
	b=UfE+spZ/1hwJkjuSO64MurTZQ0fpOpz0UOPPcbdv+gpkBL23Jkkx6+2UERfUlhC4p
	 DfUZu0h5ewMrEtsg+rJfx1rEkKRb1E8w/2GEaugq0154ZMMZFFORjT9ti+/jOmTTNQ
	 7JNKUUC5pwbjfXIJp9FQw499HTKo0viLgiwiQaTA=
Received: from mailman-core.alsa-project.org (mailman-core.alsa-project.org [10.254.200.10])
	by alsa1.perex.cz (Postfix) with ESMTP id AD164F800B8;
	Sat, 11 Feb 2023 09:42:51 +0100 (CET)
Received: by alsa1.perex.cz (Postfix, from userid 50401)
	id 13CB6F800E4; Sat, 11 Feb 2023 09:42:48 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=-0.2 required=5.0 tests=DKIM_SIGNED,DKIM_VALID,
	DKIM_VALID_AU,DKIM_VALID_EF,SPF_HELO_NONE,SPF_PASS,URIBL_BLOCKED
	shortcircuit=no autolearn=ham autolearn_force=no version=3.4.6
Received: from smtp-out2.suse.de (smtp-out2.suse.de [195.135.220.29])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature RSA-PSS (4096 bits) server-digest
 SHA256)
	(No client certificate requested)
	by alsa1.perex.cz (Postfix) with ESMTPS id 0605DF80038
	for <alsa-devel@alsa-project.org>; Sat, 11 Feb 2023 09:42:45 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 0605DF80038
Authentication-Results: alsa1.perex.cz;
	dkim=pass (1024-bit key,
 unprotected) header.d=suse.de header.i=@suse.de header.a=rsa-sha256
 header.s=susede2_rsa header.b=D/iHZR8h;
	dkim=pass header.d=suse.de header.i=@suse.de header.a=ed25519-sha256
 header.s=susede2_ed25519 header.b=ssCazD/2
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de
 [192.168.254.74])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
	(No client certificate requested)
	by smtp-out2.suse.de (Postfix) with ESMTPS id D4A311FF63;
	Sat, 11 Feb 2023 08:42:44 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.de;
 s=susede2_rsa;
	t=1676104964;
 h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
	 mime-version:mime-version:content-type:content-type:
	 in-reply-to:in-reply-to:references:references;
	bh=NQjl2BnBIRCDsFeLCejy6k4OboHxUP9crhXpuM1/Nzo=;
	b=D/iHZR8h27AHSnoH/XFZUv9oXrJMGb50dItrTf7DX8QtbTqlgOBgMZCSUyo4BAjhKG/rGh
	C7Hj9YQ4NKjjp5JmLQnlA5W+nluaquEhwDfjGO5ksyIKjO2nfV0KAR6GGnbyqhz9LyDBj2
	J/Vp5ml+W7pmitQaGAKYKgCTvAnQH00=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.de;
	s=susede2_ed25519; t=1676104964;
	h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
	 mime-version:mime-version:content-type:content-type:
	 in-reply-to:in-reply-to:references:references;
	bh=NQjl2BnBIRCDsFeLCejy6k4OboHxUP9crhXpuM1/Nzo=;
	b=ssCazD/2O6m4fqrdPYEErlktDsN3qsyyqdYlx8oZka40g8YaSfB8eUYShb8qLb4E50QViF
	z5IDrRX9mXIDoeCg==
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de
 [192.168.254.74])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
	(No client certificate requested)
	by imap2.suse-dmz.suse.de (Postfix) with ESMTPS id B068513A1F;
	Sat, 11 Feb 2023 08:42:44 +0000 (UTC)
Received: from dovecot-director2.suse.de ([192.168.254.65])
	by imap2.suse-dmz.suse.de with ESMTPSA
	id zR9ZKgRV52MLDwAAMHmgww
	(envelope-from <tiwai@suse.de>); Sat, 11 Feb 2023 08:42:44 +0000
Date: Sat, 11 Feb 2023 09:42:44 +0100
Message-ID: <87ttzsh9tn.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Mike FABIAN <mfabian@redhat.com>
Subject: Re: No sound on HDMI by default on Lenovo T14s using Fedora 37
In-Reply-To: <s9d4jrsppew.fsf@hathi.site>
References: <s9dy1pzx3ki.fsf@hathi.site>
	<87k01j6cw6.wl-tiwai@suse.de>
	<s9dfsc7ixik.fsf@hathi.site>
	<877cxj65s3.wl-tiwai@suse.de>
	<87zgaerfqv.wl-tiwai@suse.de>
	<s9dbkmtigfe.fsf@hathi.site>
	<87bkmtpft5.wl-tiwai@suse.de>
	<s9dmt5kwr3k.fsf@hathi.site>
	<s9d4jrsppew.fsf@hathi.site>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) Emacs/27.2 Mule/6.0
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=ISO-2022-JP
Message-ID-Hash: E64S7ASWBOQHISJQEF6Q2SSXV7KP7JH6
X-Message-ID-Hash: E64S7ASWBOQHISJQEF6Q2SSXV7KP7JH6
X-MailFrom: tiwai@suse.de
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency;
 loop; banned-address; member-moderation;
 header-match-alsa-devel.alsa-project.org-0;
 header-match-alsa-devel.alsa-project.org-1; nonmember-moderation;
 administrivia; implicit-dest; max-recipients; max-size; news-moderation;
 no-subject; digests; suspicious-header
CC: alsa-devel@alsa-project.org, Takashi Iwai <tiwai@suse.com>
X-Mailman-Version: 3.3.8
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
Archived-At: 
 <https://mailman.alsa-project.org/hyperkitty/list/alsa-devel@alsa-project.org/message/E64S7ASWBOQHISJQEF6Q2SSXV7KP7JH6/>
List-Archive: 
 <https://mailman.alsa-project.org/hyperkitty/list/alsa-devel@alsa-project.org/>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Owner: <mailto:alsa-devel-owner@alsa-project.org>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Subscribe: <mailto:alsa-devel-join@alsa-project.org>
List-Unsubscribe: <mailto:alsa-devel-leave@alsa-project.org>

On Sat, 11 Feb 2023 09:38:47 +0100,
Mike FABIAN wrote:
> 
> And now I rebooted again after yet another kernel update (I did not
> change anything apart from "sudo dnf update" and reboot).
> 
> Now it is working again. I have attached the output of alsa-info.sh for
> the non-working case.
> 
> Could it be that the kernel update had nothing to do with it working now
> and that it switches between working and not working "randomly" when rebooting?

Well, it's hard to tell...  If it's broken silently (literally, no
error log reported), that's likely some issue of the driver (either
graphics or HDMI-audio).  OTOH, if you see any relevant error/warning
log from pipewire or the kernel driver, it'd be more about the
inconsistency in the configuration.


Takashi

> 
> Mike FABIAN <mfabian@redhat.com> さんはかきました:
> 
> > Now it suddenly stopped working again after a reboot although I did not
> > change anything with the module options.
> >
> > The output of alsa-info.sh for the non-working state I have now is
> > attached.
> >
> >
> > Takashi Iwai <tiwai@suse.de> さんはかきました:
> >
> >> Please check /proc/asound/card0/eld#* (for the card number 0, as
> >> found in /proc/asound/cards as sof-hda-dsp).  One of them should have
> >> a valid ELD entry.  This is the first step.  If no proper monitor and
> >> ELD is found in those, something wrong at the detection in the
> >> kernel.
> >
> > $ cat /proc/asound/card0/eld#2.21 
> > monitor_present         1
> > eld_valid               1
> > codec_pin_nid           0xc
> > codec_dev_id            0x1
> > codec_cvt_nid           0x3
> > monitor_name            LG ULTRAFINE
> > connection_type         DisplayPort
> > eld_version             [0x2] CEA-861D or below
> > edid_version            [0x3] CEA-861-B, C or D
> > manufacture_id          0x6d1e
> > product_id              0x5bc2
> > port_id                 0x0
> > support_hdcp            0
> > support_ai              0
> > audio_sync_delay        0
> > speakers                [0x1] FL/FR
> > sad_count               1
> > sad0_coding_type        [0x1] LPCM
> > sad0_channels           2
> > sad0_rates              [0xe0] 32000 44100 48000
> > sad0_bits               [0xe0000] 16 20 24
> > mfabian@hathi:~
> > $ 
> >
> > That is OK, right?
> >
> > $ cat /proc/asound/cards
> >  0 [sofhdadsp      ]: sof-hda-dsp - sof-hda-dsp
> >                       LENOVO-20WNS1F81R-ThinkPadT14sGen2i
> >  1 [USB            ]: USB-Audio - ThinkPad Thunderbolt 3 Dock USB
> >                       Lenovo ThinkPad Thunderbolt 3 Dock USB at usb-0000:52:00.0-2.1.1.2, full speed
> > $ 
> >
> >> The next is to test aplay directly with the device.
> >> "aplay -L" will show the possible option, and you can try like
> >>
> >>   % apaly -Dhdmi:CARD=xxx,DEV=x -vv foo.wav
> >>
> >> for a WAV file in a format matching with the supported device
> >> (typically 2 channel stereo 44.1kHz or 48kHz 16 or 32bit format).
> >> If this gets a busy error, stop wireplumber once during the test:
> >>   % systemctl --user stop wireplumber
> >>   % aplay ....
> >>   % systemctl --user start wireplumber
> >>
> >> If the aplay test doesn't work, again, it means that there's something
> >> wrong in the kernel.
> >
> > $ file /usr/share/ibus-typing-booster/data/coin9.wav 
> > /usr/share/ibus-typing-booster/data/coin9.wav: RIFF (little-endian) data, WAVE audio, Microsoft PCM, 16 bit, mono 44100 Hz
> > mfabian@hathi:~
> > $ aplay -Dhdmi:CARD=sofhdadsp,DEV=0 -vv /usr/share/ibus-typing-booster/data/coin9.wav
> > ALSA lib conf.c:5671:(snd_config_expand) Unknown parameters CARD=sofhdadsp,DEV=0
> > ALSA lib pcm.c:2666:(snd_pcm_open_noupdate) Unknown PCM hdmi:CARD=sofhdadsp,DEV=0
> > aplay: main:831: audio open error: 無効な引数です
> >
> > I don’t know what that means.
> >
> > [...]
> >
> >
> >> That might explain.  There were a few fixes about HDMI HD-audio stuff
> >> recently.
> 
> -- 
> Mike FABIAN <mfabian@redhat.com>
> 睡眠不足はいい仕事の敵だ。
> 
