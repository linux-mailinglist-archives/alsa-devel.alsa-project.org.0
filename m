Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 5DB0F2099F1
	for <lists+alsa-devel@lfdr.de>; Thu, 25 Jun 2020 08:43:21 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id BEC8C18C1;
	Thu, 25 Jun 2020 08:42:30 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz BEC8C18C1
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1593067400;
	bh=eTUSU+d9uCBiygnx2fgjHYCPQD4UaOGi1dXs0uOuxck=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=HWs3BxgcKn2mjqzU2kyRTbH91eS6kvbpKu4vDKdURCnhZhZT5Gb27XuXwRCd+iyrc
	 XaGAH9gUipxLXyd4MrgOSx9qqFJZtADGuxp0AwxVNK4VJMudtVwd0G7hjPAsinCtlL
	 lJ/DT8oEZ7jBRKeL/lbuaTv5VJ0WC+Cd6U3F0vv8=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id A1662F800B2;
	Thu, 25 Jun 2020 08:41:39 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id DD1F2F80234; Thu, 25 Jun 2020 08:41:35 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=RCVD_IN_MSPIKE_H3,
 RCVD_IN_MSPIKE_WL,SPF_HELO_NONE,SPF_PASS autolearn=disabled version=3.4.0
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 3E6C5F800B2
 for <alsa-devel@alsa-project.org>; Thu, 25 Jun 2020 08:41:29 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 3E6C5F800B2
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id 4F411AAD0;
 Thu, 25 Jun 2020 06:41:28 +0000 (UTC)
Date: Thu, 25 Jun 2020 08:41:28 +0200
Message-ID: <s5hbll7ir53.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: "N, Harshapriya" <harshapriya.n@intel.com>
Subject: Re: [PATCH] ALSA: hda/hdmi: Add Intel silent stream support
In-Reply-To: <BY5PR11MB43073E2381CE37D7CF584234FD950@BY5PR11MB4307.namprd11.prod.outlook.com>
References: <1592954796-12449-1-git-send-email-harshapriya.n@intel.com>
 <s5hr1u4lxee.wl-tiwai@suse.de>
 <f2da25c0-c740-4d44-ab66-6017622f7dde@perex.cz>
 <7dd38f98-e74a-94c0-6888-523e6189c00b@linux.intel.com>
 <s5ho8p8ifcn.wl-tiwai@suse.de>
 <2404f45d-832d-69a0-fb3b-1981ae455f50@linux.intel.com>
 <s5hftakid2e.wl-tiwai@suse.de>
 <BY5PR11MB43073E2381CE37D7CF584234FD950@BY5PR11MB4307.namprd11.prod.outlook.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: "Vehmanen, Kai" <kai.vehmanen@intel.com>, "Jillela,
 Emmanuel" <emmanuel.jillela@intel.com>,
 "alsa-devel@alsa-project.org" <alsa-devel@alsa-project.org>,
 Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Wed, 24 Jun 2020 19:58:40 +0200,
N, Harshapriya wrote:
> 
> > On Wed, 24 Jun 2020 19:05:14 +0200,
> > Pierre-Louis Bossart wrote:
> > >
> > >
> > >
> > > On 6/24/20 11:43 AM, Takashi Iwai wrote:
> > > > On Wed, 24 Jun 2020 17:33:45 +0200,
> > > > Pierre-Louis Bossart wrote:
> > > >>
> > > >>
> > > >>>>> The silent stream is enabled with a Kconfig option, as well as a
> > > >>>>> kernel parameter should there be a need to override the build time
> > default.
> > > >>>>
> > > >>>> I'm not sure whether the module option is the best interface.
> > > >>>> An alternative is a mixer element that controls dynamically.
> > > >>>> Then it'll be per card unlike the module option.
> > > >>>
> > > >>> +1, kcontrol seems the appropriate way to control this.
> > > >>
> > > >> It was my suggestion to use Kconfig+kernel parameter for
> > > >> simplicity/overrides.
> > > >>
> > > >> The kcontrol is a nice idea, but in practice we typically only have
> > > >> one card dealing with HDMI.
> > > >
> > > > Not really.  There are systems with two HDMI outputs from both
> > > > integrated and discrete GPUs.  Most modern systems are only with
> > > > hybrid graphics, though.
> > >
> > > Ok, maybe I am mistaken, in most of the HDMI issues we've seen only
> > > one HDMI source.
> > >
> > > But it's a good point that this is only supposed to be used for Intel
> > > whether it's a kernel parameter or a kcontrol shouldn't this be
> > > dependent on a PCI ID being detected and a SKYLAKE flag being set?
> > > it's my understanding that this applies from Skylake to TigerLake, not
> > > before.
> > 
> > I guess we can check it from the codec ID?  Change the probe function for
> > Skylake+ codecs to patch_i915_skl_hdmi and co, and set the flag there.
> > 
> > > >> It also doesn't have a UCM representation so would force the use of
> > > >> amixer and manual configs, or the UCM file would always set the
> > > >> mode.
> > > >
> > > > But people usually use the distro kernels, so the situation is more
> > > > or less equivalent; you'd have to adjust a module option manually if
> > > > you want a different one from the default, and you'd have to be root
> > > > to change it.
> > > >
> > > > So, rather the question is how we should provide the setup of such
> > > > parameter.  It's supposed to be a part of power management stuff
> > > > that should be touched by either a smart PM tool or a manual
> > > > override such as runtime PM setup?  Or can it be seen as a more casual
> > tuning?
> > >
> > > I am not aware of such tools. The only thing I know is that some of
> > > the HDaudio power settings are already controlled by kernel
> > > parameters, e.g.
> > >
> > > /etc/modprobe.d/audio_powersave.conf
> > > options snd_hda_intel power_save=1
> > 
> > Yes, it's been the primary knob for years to turn on/off the runtime PM for HD-
> > audio and other legacy drivers.  This was used by powertop or some other
> > power-aware daemons and tools, to be toggled dynamically per the power
> > cable state or such.
> > 
> > And, how the silent stream feature should be seen?
> > Should it be a system-wide root-only setup or adjustable per user?
> > Would it be changed often?  Such questions and answers will lead us to the
> > right direction, I hope.
> I think this feature should not be adjustable by the user during runtime because,
> a)  It's based on the platform and OEM preference of having it (given it has power implications)

Well, the argument isn't equivalent with runtime PM.  The runtime PM
is supposed to keep the almost same functionality, hence it's
preferred to be enabled unless you hit a clear demerit (e.g. click
noise or such).  But this one is rather a trade-off between power-save
vs avoiding the drop of first samples.

The problem is that this feature blocks the whole runtime PM, even if
you don't use HDMI audio.  From that point, I guess many users prefer
this off for those who don't use HDMI audio.

> b) Changing it on the runtime will cause the issue of unbalanced power up/down sequence like you mentioned

This should be no problem if we do code right :)


thanks,

Takashi
