Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 57C5367B5F1
	for <lists+alsa-devel@lfdr.de>; Wed, 25 Jan 2023 16:30:37 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher ADH-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id C500CE78;
	Wed, 25 Jan 2023 16:29:46 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz C500CE78
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1674660636;
	bh=BFbBOPYOmNgn6KIsG2DV8Kin5cjv9WVfX5oJlPISId4=;
	h=Date:From:To:Subject:In-Reply-To:References:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 Cc:From;
	b=bjB6ujEQzCpHgudjHtcDz1v+cT+y+Uo7Q90Et+ji9krG3K6KtvqL4sUjF27W7XKO8
	 56J8drG9ZtwfpNiRUT2F3lSw73MIisAx+Ghx/DK7vFvN/MkBtPY9l9GCzUCxJ58ZRo
	 4bXhgek6foprFZsYvXMjCnQKdsq269FTfPhg+Bgo=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 84ED5F80163;
	Wed, 25 Jan 2023 16:29:38 +0100 (CET)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 8D6BBF80424; Wed, 25 Jan 2023 16:29:37 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=-5.2 required=5.0 tests=DKIM_SIGNED,DKIM_VALID,
 DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_HI,SPF_HELO_NONE,SPF_PASS,
 URIBL_BLOCKED shortcircuit=no autolearn=ham autolearn_force=no
 version=3.4.6
Received: from smtp-out1.suse.de (smtp-out1.suse.de [IPv6:2001:67c:2178:6::1c])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature RSA-PSS (4096 bits) server-digest SHA256)
 (No client certificate requested)
 by alsa1.perex.cz (Postfix) with ESMTPS id 90D3CF800FB
 for <alsa-devel@alsa-project.org>; Wed, 25 Jan 2023 16:29:20 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 90D3CF800FB
Authentication-Results: alsa1.perex.cz;
 dkim=pass (1024-bit key, unprotected) header.d=suse.de header.i=@suse.de
 header.a=rsa-sha256 header.s=susede2_rsa header.b=kC4+dNeG; 
 dkim=pass header.d=suse.de header.i=@suse.de header.a=ed25519-sha256
 header.s=susede2_ed25519 header.b=xxDyM3XI
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de [192.168.254.74])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
 (No client certificate requested)
 by smtp-out1.suse.de (Postfix) with ESMTPS id 0E96221C08;
 Wed, 25 Jan 2023 15:29:20 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.de; s=susede2_rsa;
 t=1674660560; h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 in-reply-to:in-reply-to:references:references;
 bh=qJ95Bpvn2pwx4kUannhtuEsx1yTJsqOqSthXE/Qaz+Y=;
 b=kC4+dNeGrO5Wc3rsE6w8QMzTDBMXDKrnRpZeZdN3eFonURTHb12Z9Kg2G4oVCoOU36wE9s
 AJTMA2Cj4Qg/nz5gEtv0ObY7nGs6inxmqbEG2yzkc/jpa9GT51+p3n4Rl4IS1w4vjY2FsB
 qcvaU9LzMIuFwMQBTB9xu4SmHFP+sDs=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.de;
 s=susede2_ed25519; t=1674660560;
 h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 in-reply-to:in-reply-to:references:references;
 bh=qJ95Bpvn2pwx4kUannhtuEsx1yTJsqOqSthXE/Qaz+Y=;
 b=xxDyM3XI5vrBZFKaVIZ9WRN10kOCyVLcgdCEoUs0etZo8PSnDWekqfkTMhYnn7Gjtyi08X
 wjVjrOrx4qvxqEAA==
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de [192.168.254.74])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
 (No client certificate requested)
 by imap2.suse-dmz.suse.de (Postfix) with ESMTPS id EA2E81339E;
 Wed, 25 Jan 2023 15:29:19 +0000 (UTC)
Received: from dovecot-director2.suse.de ([192.168.254.65])
 by imap2.suse-dmz.suse.de with ESMTPSA id ckc6OM9K0WMmbwAAMHmgww
 (envelope-from <tiwai@suse.de>); Wed, 25 Jan 2023 15:29:19 +0000
Date: Wed, 25 Jan 2023 16:29:19 +0100
Message-ID: <87o7qmtyy8.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: alsa-devel@alsa-project.org
Subject: Re: [PATCH 0/2] ALSA: memalloc: Fix for Xen PV and non-IOMMU systems
In-Reply-To: <20230124092744.27370-1-tiwai@suse.de>
References: <20230124092744.27370-1-tiwai@suse.de>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) Emacs/27.2 Mule/6.0
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Cc: Marek =?ISO-8859-1?Q?Marczykowski-G=F3recki?=
 <marmarek@invisiblethingslab.com>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>

On Tue, 24 Jan 2023 10:27:42 +0100,
Takashi Iwai wrote:
> 
> Hi,
> 
> this is a patch series to address the recent regression on Xen PV (and
> possibly non-IOMMU) systems about the SG-buffer memory allocation.
> We switched to use dma_alloc_noncontiguous() as hoped it handling
> everything right, but it turned out that this doesn't work always.
> So this is one step back, use the explicit SG-buffer with
> dma_alloc_coherent() calls, but in a bit more optimized ways, and also
> applying only for those systems.

It seems that the second patch causes a problem; at least I see casual
Oopses on my system after using the patch.  Let's scratch.

I'll resubmit the fix.  Marek, could you try that later and report
back if it still works and doesn't break things again?


thanks,

Takashi
