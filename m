Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id 6E16216B87D
	for <lists+alsa-devel@lfdr.de>; Tue, 25 Feb 2020 05:21:56 +0100 (CET)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id DCAA1168F;
	Tue, 25 Feb 2020 05:21:05 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz DCAA1168F
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1582604516;
	bh=cxonSlPzL9++XArmqi8GEXLfoZptDSa0Hyd9Icy7upg=;
	h=Date:From:To:Subject:In-Reply-To:References:Cc:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=jHf2t+AdGaXbTjDFf4hW7Y/SY8i5eUu7prtwgBu+cBaFv1LZW/sORM8pM24FxQ8eW
	 D1/dKHrWAplpVw8hg7LsUP5xc7XyQDnSZPSFpqf/efVzESoXMocsfmF/1aWEkx++Sk
	 gYQqOG1drVYj5ikf406wbFLHZr9/9ZKjxfM+ZUhc=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id E8568F800AD;
	Tue, 25 Feb 2020 05:20:14 +0100 (CET)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id 2D1ACF80142; Tue, 25 Feb 2020 05:20:12 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.2 required=5.0 tests=PRX_BODY_76,SPF_HELO_NONE,
 SPF_PASS autolearn=disabled version=3.4.0
Received: from relmlie6.idc.renesas.com (relmlor2.renesas.com
 [210.160.252.172])
 by alsa1.perex.cz (Postfix) with ESMTP id 19F80F800AD
 for <alsa-devel@alsa-project.org>; Tue, 25 Feb 2020 05:20:04 +0100 (CET)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 19F80F800AD
Date: 25 Feb 2020 13:20:01 +0900
X-IronPort-AV: E=Sophos;i="5.70,482,1574089200"; d="scan'208";a="39940289"
Received: from unknown (HELO relmlir5.idc.renesas.com) ([10.200.68.151])
 by relmlie6.idc.renesas.com with ESMTP; 25 Feb 2020 13:20:01 +0900
Received: from mercury.renesas.com (unknown [10.166.252.133])
 by relmlir5.idc.renesas.com (Postfix) with ESMTP id 245D54002644;
 Tue, 25 Feb 2020 13:20:01 +0900 (JST)
Message-ID: <87zhd7jo3b.wl-kuninori.morimoto.gx@renesas.com>
From: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
To: Mark Brown <broonie@kernel.org>
Subject: Re: [alsa-devel] [PATCH 7/7] ASoC: soc-pcm: tidyup soc_pcm_open()
 order
In-Reply-To: <20200225014039.GA21366@sirena.org.uk>
References: <877e1doeis.wl-kuninori.morimoto.gx@renesas.com>
 <87wo9dmzwv.wl-kuninori.morimoto.gx@renesas.com>
 <eb217e1e-6438-b59d-c155-5fe53de542ee@linux.intel.com>
 <20200225014039.GA21366@sirena.org.uk>
User-Agent: Wanderlust/2.15.9 Emacs/25.2 Mule/6.0
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Cc: Liam Girdwood <liam.r.girdwood@linux.intel.com>,
 Linux-ALSA <alsa-devel@alsa-project.org>,
 Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>


Hi Pierre-Louis, Mark

> > you'll see that the intent was to
> > - start the cpu_dai
> > - open the platform driver to e.g handle DMAs
> > - start the codec_dai.
> 
> > The second step is not really needed for Intel but might be needed on others
> > where the DMA is centrally handled (Omap, etc).
> 
> > My concern is that we've modified the order to deal with module
> > dependencies, without necessarily taking into account that DMA setup part
> 
> > That said I don't understand the initial sequence for soc_pcm_close() so I
> > am not advocating for a revert, but more a clarification of what those
> > component open/close steps are supposed to do.
> 
> It's possible we're going to shake some issues out here but the
> ordering has always been a bit arbitrary, especially the CPU vs
> CODEC ordering.  We're basically hoping that the ordering we've
> picked is the one that causes fewest glitches and upsets on the
> broad range of hardware.  My expectation/hope is that for most
> hardware the flow control between the DAI and the DMA controller
> (which has to be there anyway) will mean that it mostly doesn't
> matter, if there's anything that is too sensitive to it we can
> always revert and try something
> else.

I'm sorry to not clarify the detail.
Yes, as you mentioned, the patch exchanged start/stop order,
and some platform *might* get damage (I hope not, of course).

But we can't say that the previous order was the best order for all platform.
I'm thinking that the current order is also not the best,
but is not random.
The *best* solution is that we need to have xxx_order flag like for_each_comp_order().

Thank you for your help !!
Best regards
---
Kuninori Morimoto
