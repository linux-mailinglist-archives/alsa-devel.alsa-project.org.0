Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id D9E64578A4
	for <lists+alsa-devel@lfdr.de>; Thu, 27 Jun 2019 02:54:52 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 396A516BC;
	Thu, 27 Jun 2019 02:54:02 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 396A516BC
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1561596892;
	bh=ocpk+0CD89ZKNPlnSrjJWj1yG5pY1qvuZ2fDGMhxB0U=;
	h=Date:From:To:In-Reply-To:References:Cc:Subject:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=MEpA8/YwK1oNE0W9gQQlPLjqzdX1Ya7+4exxZUfETHXQIiWC2PttJplfMUlNlnbIt
	 SNFPX7X/adNTCNBptd3xIdBIEqlaBm3+UU2HpDjRLwJlsSxkPf2HjuFCCnIfeQDd3D
	 d5tU1uqzFsybJvH+nt7JIUYL3AMnfvBwUgquWuLk=
Received: from alsa1.perex.cz (localhost.localdomain [127.0.0.1])
	by alsa1.perex.cz (Postfix) with ESMTP id 70923F896B7;
	Thu, 27 Jun 2019 02:53:07 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Received: by alsa1.perex.cz (Postfix, from userid 50401)
 id E2DCFF896B9; Thu, 27 Jun 2019 02:53:05 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=SPF_HELO_NONE,SPF_PASS
 autolearn=disabled version=3.4.0
Received: from relmlie5.idc.renesas.com (relmlor1.renesas.com
 [210.160.252.171])
 by alsa1.perex.cz (Postfix) with ESMTP id 9C15BF8070C
 for <alsa-devel@alsa-project.org>; Thu, 27 Jun 2019 02:52:57 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 9C15BF8070C
Date: 27 Jun 2019 09:52:54 +0900
X-IronPort-AV: E=Sophos;i="5.62,421,1554735600"; d="scan'208";a="19805080"
Received: from unknown (HELO relmlir6.idc.renesas.com) ([10.200.68.152])
 by relmlie5.idc.renesas.com with ESMTP; 27 Jun 2019 09:52:54 +0900
Received: from morimoto-PC.renesas.com (unknown [10.166.18.140])
 by relmlir6.idc.renesas.com (Postfix) with ESMTP id 217B4412F212;
 Thu, 27 Jun 2019 09:52:54 +0900 (JST)
Message-ID: <874l4bkg16.wl-kuninori.morimoto.gx@renesas.com>
From: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
To: Daniel Baluta <daniel.baluta@gmail.com>
In-Reply-To: <CAEnQRZBnvfuZDbnvbmqAavh9DAbA_EeRc6OuH6OOiR1WB4zUrg@mail.gmail.com>
References: <87h893mkvi.wl-kuninori.morimoto.gx@renesas.com>
 <87sgsnfjge.wl-kuninori.morimoto.gx@renesas.com>
 <CAEnQRZBnvfuZDbnvbmqAavh9DAbA_EeRc6OuH6OOiR1WB4zUrg@mail.gmail.com>
User-Agent: Wanderlust/2.15.9 Emacs/24.5 Mule/6.0
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Cc: Linux-ALSA <alsa-devel@alsa-project.org>, "Sridharan,
 Ranjani" <ranjani.sridharan@intel.com>, Liam Girdwood <lgirdwood@gmail.com>,
 Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>,
 paul.olaru@nxp.com, Mark Brown <broonie@kernel.org>,
 Daniel Baluta <daniel.baluta@nxp.com>
Subject: Re: [alsa-devel] [PATCH v2 116/146] ASoC: sof: use modern dai_link
	style
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <https://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <https://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Errors-To: alsa-devel-bounces@alsa-project.org
Sender: "Alsa-devel" <alsa-devel-bounces@alsa-project.org>


Hi Daniel

Thank you for feedback and sorry for bother you

> > @@ -2708,7 +2705,11 @@ static int sof_link_load(struct snd_soc_component *scomp, int index,
> >         int ret;
> >         int i = 0;
> >
> > -       link->platform_name = dev_name(sdev->dev);
> > +       if (!link->platforms) {
> > +               dev_err(sdev->dev, "error: no platforms\n");
> > +               return -EINVAL;
> 
> Why do we need this check? With linux-next this check fails for me.

I don't remember but some sof might use without platform it I thought.
But, current ALSA SoC can handle NULL platform today.
Maybe/Maybe not support timing issue ?

> diff --git a/sound/soc/soc-topology.c b/sound/soc/soc-topology.c
> index f485f7f751a1..ee73318135fc 100644
> --- a/sound/soc/soc-topology.c
> +++ b/sound/soc/soc-topology.c
> @@ -1883,7 +1883,7 @@ static int soc_tplg_fe_link_create(struct soc_tplg *tplg,
>         int ret;
> 
>         /* link + cpu + codec */
> -       link = kzalloc(sizeof(*link) + (2 * sizeof(*dlc)), GFP_KERNEL);
> +       link = kzalloc(sizeof(*link) + (3 * sizeof(*dlc)), GFP_KERNEL);
>         if (link == NULL)
>                 return -ENOMEM;
> 
> @@ -1891,9 +1891,11 @@ static int soc_tplg_fe_link_create(struct soc_tplg *tplg,
> 
>         link->cpus      = &dlc[0];
>         link->codecs    = &dlc[1];
> +       link->platforms = &dlc[2];
> 
>         link->num_cpus   = 1;
>         link->num_codecs = 1;
> +       link->num_platforms = 1;
> 
> Can you please help me figure this out?

I think this is same as

	3e6de89409bf7ad149bfb05dd0dce6c5678ea0a8
	("ASoC: soc-topology: fix modern dai link style")

Above one is also OK, but now we can use NULL platform.
I'm not familiar with SOF, but maybe like this code instead
of having dummy platform can salve your issue ?

	if (link->platforms) {
		link->platforms->name = dev_name(sdev->dev);
	}

_______________________________________________
Alsa-devel mailing list
Alsa-devel@alsa-project.org
https://mailman.alsa-project.org/mailman/listinfo/alsa-devel
