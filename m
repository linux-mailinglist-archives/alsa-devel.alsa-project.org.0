Return-Path: <alsa-devel-bounces@alsa-project.org>
X-Original-To: lists+alsa-devel@lfdr.de
Delivered-To: lists+alsa-devel@lfdr.de
Received: from alsa0.perex.cz (alsa0.perex.cz [77.48.224.243])
	by mail.lfdr.de (Postfix) with ESMTPS id B42F3758F01
	for <lists+alsa-devel@lfdr.de>; Wed, 19 Jul 2023 09:29:03 +0200 (CEST)
Received: from alsa1.perex.cz (alsa1.perex.cz [207.180.221.201])
	(using TLSv1.2 with cipher ADH-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by alsa0.perex.cz (Postfix) with ESMTPS id 2D5061F3;
	Wed, 19 Jul 2023 09:28:13 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa0.perex.cz 2D5061F3
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=alsa-project.org;
	s=default; t=1689751743;
	bh=C+G/kKSk28N6n+PaHlgZ/jsL6ybWd1m68p8rjKEtrGU=;
	h=Date:From:To:Cc:Subject:In-Reply-To:References:List-Id:
	 List-Archive:List-Help:List-Owner:List-Post:List-Subscribe:
	 List-Unsubscribe:From;
	b=KxmR+qho0cnGJ4uMaPyCZTm/EOsu1zGm+jzYx2am+6w7ItRINamc6bSJzr6/cKcst
	 Inmh1obq0cKnm3AgeH1odxCGQyiXMqj9ghtbYw+H3HOFrct3u9erjREHkVzzFRPfgh
	 HX/NzdOoAD7sLtwEj3wtXRo6MhO1ouxBKD47C46M=
Received: by alsa1.perex.cz (Postfix, from userid 50401)
	id 48149F80520; Wed, 19 Jul 2023 09:27:51 +0200 (CEST)
Received: from mailman-core.alsa-project.org (mailman-core.alsa-project.org [10.254.200.10])
	by alsa1.perex.cz (Postfix) with ESMTP id BBCD0F8032D;
	Wed, 19 Jul 2023 09:27:50 +0200 (CEST)
Received: by alsa1.perex.cz (Postfix, from userid 50401)
	id 8C16BF8047D; Wed, 19 Jul 2023 09:27:46 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on alsa1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=-5.2 required=5.0 tests=DKIM_SIGNED,DKIM_VALID,
	DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_HI,SPF_HELO_NONE,SPF_PASS,
	T_SCC_BODY_TEXT_LINE,URIBL_BLOCKED shortcircuit=no autolearn=ham
	autolearn_force=no version=3.4.6
Received: from smtp-out1.suse.de (smtp-out1.suse.de [195.135.220.28])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature RSA-PSS (4096 bits) server-digest
 SHA256)
	(No client certificate requested)
	by alsa1.perex.cz (Postfix) with ESMTPS id 07D9FF80153
	for <alsa-devel@alsa-project.org>; Wed, 19 Jul 2023 09:27:41 +0200 (CEST)
DKIM-Filter: OpenDKIM Filter v2.11.0 alsa1.perex.cz 07D9FF80153
Authentication-Results: alsa1.perex.cz;
	dkim=pass (1024-bit key,
 unprotected) header.d=suse.de header.i=@suse.de header.a=rsa-sha256
 header.s=susede2_rsa header.b=ecFuduxo;
	dkim=pass header.d=suse.de header.i=@suse.de header.a=ed25519-sha256
 header.s=susede2_ed25519 header.b=lzpWobCS
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de
 [192.168.254.74])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
	(No client certificate requested)
	by smtp-out1.suse.de (Postfix) with ESMTPS id 3E078218E3;
	Wed, 19 Jul 2023 07:27:41 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.de;
 s=susede2_rsa;
	t=1689751661;
 h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
	 mime-version:mime-version:content-type:content-type:
	 in-reply-to:in-reply-to:references:references;
	bh=rmv76P6s197rjvQIeRiEIest0EeTWUesKD8sObWD+E4=;
	b=ecFuduxo+gAGJOmCoMoL8CwhmbiQvK7KDSg+yA8KT6RX/39fggFBztR89qmE8S5SWCBPPk
	EQik6ZpFjNkT0ZnKibWRoy6p/01LoZX+szfrhIcL4py+pOAyJoo76l/6wQZI/jETBMV32z
	T0FA4ub4mhxnDWRLWDVyGRR8mcEsHt8=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.de;
	s=susede2_ed25519; t=1689751661;
	h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
	 mime-version:mime-version:content-type:content-type:
	 in-reply-to:in-reply-to:references:references;
	bh=rmv76P6s197rjvQIeRiEIest0EeTWUesKD8sObWD+E4=;
	b=lzpWobCS2zPGxYnDz8b4QK6vEh99nVyzZywjbdCuJD0lcJwoxc/73KvvmWmBG/NaLC5+V0
	OU6REUOG/Jh0GzDQ==
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de
 [192.168.254.74])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
	(No client certificate requested)
	by imap2.suse-dmz.suse.de (Postfix) with ESMTPS id 000FA13460;
	Wed, 19 Jul 2023 07:27:40 +0000 (UTC)
Received: from dovecot-director2.suse.de ([192.168.254.65])
	by imap2.suse-dmz.suse.de with ESMTPSA
	id AvzDOmyQt2RMXAAAMHmgww
	(envelope-from <tiwai@suse.de>); Wed, 19 Jul 2023 07:27:40 +0000
Date: Wed, 19 Jul 2023 09:27:40 +0200
Message-ID: <87y1jcl5sj.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Carl Klemm <carl@uvos.xyz>
Cc: alsa-devel@alsa-project.org,
	alsa-devel@vger.kernel.org,
	linux-sound@vger.kernel.org
Subject: Re: [BUG REPORT] sound: pci: ctxfi: htimestamp dose not work on
 EMU20k during recording
In-Reply-To: <dde0a305793ad7ddbd9e001e463207a84c2afcc9.camel@uvos.xyz>
References: <dde0a305793ad7ddbd9e001e463207a84c2afcc9.camel@uvos.xyz>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) Emacs/27.2 Mule/6.0
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Message-ID-Hash: IWB54T2VKNZ2MJPM6ZCVMWNQMVJPMOY7
X-Message-ID-Hash: IWB54T2VKNZ2MJPM6ZCVMWNQMVJPMOY7
X-MailFrom: tiwai@suse.de
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency;
 loop; banned-address; member-moderation;
 header-match-alsa-devel.alsa-project.org-0;
 header-match-alsa-devel.alsa-project.org-1; nonmember-moderation;
 administrivia; implicit-dest; max-recipients; max-size; news-moderation;
 no-subject; digests; suspicious-header
X-Mailman-Version: 3.3.8
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
Archived-At: 
 <https://mailman.alsa-project.org/hyperkitty/list/alsa-devel@alsa-project.org/message/IWB54T2VKNZ2MJPM6ZCVMWNQMVJPMOY7/>
List-Archive: 
 <https://mailman.alsa-project.org/hyperkitty/list/alsa-devel@alsa-project.org/>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Owner: <mailto:alsa-devel-owner@alsa-project.org>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Subscribe: <mailto:alsa-devel-join@alsa-project.org>
List-Unsubscribe: <mailto:alsa-devel-leave@alsa-project.org>

On Wed, 19 Jul 2023 09:10:12 +0200,
Carl Klemm wrote:
> 
> Hi,
> 
> see https://gitlab.freedesktop.org/pipewire/pipewire/-/issues/3352
> htimestamp returns nonesensical values when recording is active on a
> EMU20k device

The driver doesn't provide any own implementation of PCM tstamp, hence
it must be the standard values.  That said, the incorrect values are
rather the "avail", that is the PCM position, not the timestamp
itself, I suppose.

Is it only about recording, i.e. playback doesn't show any wrong
values?

In anyway, try to enable the tracing for snd_pcm, get the position and
the system timestamp during recording, and verify whether the reported
values are reasonable or not.


Takashi
